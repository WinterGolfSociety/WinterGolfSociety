<!DOCTYPE html>
<html>
   <head>
      <meta charset="UTF-8">
      <meta content="width=device-width, initial-scale=1.0" name="viewport">
      <meta content="ie=edge" http-equiv="X-UA-Compatible">
      <title>4score</title>
       <link href='https://fonts.googleapis.com/css?family=Kalam' rel='stylesheet'>
      <link href='https://fonts.googleapis.com/css?family=Kalam' rel='stylesheet'>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
      <style>
         body {
         font-family: Kalam;
         font-size: 3vh;
         }
         /* front screen */
         .grid-container-frontscreen {
         display: grid;
         grid-template-columns: auto auto auto;
         //width: 94vw;
         }
         .grid-container-frontscreen > div {
         font-size: 3vh;
         text-align: left;
         }
         /* front screen */
         .grid-container-popup {
         display: grid;
         grid-template-columns: auto auto auto auto auto;
         //width: 94vw;
         padding-right: 10px;
         }
         .grid-container-popup > div {
         font-size: 3vh;
         text-align: center;
         }
         .grid-container-mini {
         display: grid;
         grid-template-columns: 25% 25% 25% 25%;
         }
         .grid-container-mini > div {
         display: flex;
         justify-content: center;
         align-items: center;
         }
         #dropbtn {
         display: flex;
         justify-content: center;
         align-items: center;
         color: white;
         height: 20vh;
         font-size: 3vmax;
         border: 2px solid silver;
         background: dodgerBlue;
         border-radius: 5px;
         }
         .dropdown {
         position: relative;
         display: inline-block;
         }
         .dropdown-content {
         display: none;
         position: absolute;
         background-color: white;
         min-width: 160px;
         overflow: auto;
         box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
         z-index: 1;
         border-radius: 5px;
         box-shadow: 10px 10px 25px black;
         max-height: 60vh;
         }
         .dropdown-content a {
         color: gray;
         padding: 10px 16px;
         text-decoration: none;
         display: block;
         }
         .show {
         display: block;
         }
         .wrapper {
         display: grid;
         grid-template-columns: repeat(6, [col] auto);
         background-color: rgb(0, 0, 20);
         color: white;
         height: 100vmax;
         align-items: center;
         justify-items: center;
         scroll-snap-align: start;
         scroll-snap-stop: always;
         font-size: 3vmax;
         }
         #firstscreen {
         -webkit-animation-duration: 1.5s;
         animation-duration: 1.5s;
         -webkit-animation-fill-mode: both;
         animation-fill-mode: both;
         }
         #all {
         display: none;
         }
         @-webkit-keyframes fadeOut {
         0% {
         opacity: 1;
         }
         100% {
         opacity: 0;
         }
         }
         @keyframes fadeOut {
         0% {
         opacity: 1;
         }
         100% {
         opacity: 0;
         }
         }
         .fadeOut {
         -webkit-animation-name: fadeOut;
         animation-name: fadeOut;
         }
         .spacer1 {
         height: 5vh;
         }
         #edithcps, #startscoring, #dawsonbutton, #lakesbutton, #oldcoursebutton, #finishbutton {
         color: white;
         width: 100%;
         height: 15vh;
         font-size: 3vmax;
         border: 2px solid silver;
         background: dodgerBlue;
         border-radius: 5px;
         }
         #startscoring {
         display: none;
         }
         #hcp1btn, #hcp2btn, #hcp3btn, #hcp4btn {
         font-size: 3vh;
         color: black;
         background-color: silver;
         border-radius: 5px;
         border: 1px solid #aaa;
         }
         #minus1btn, #minus2btn, #minus3btn, #minus4btn {
         font-size: 8vh;
         color: dodgerBlue;
         background-color: silver;
         border-radius: 5px;
         border: 1px solid #aaa;
         }
         #plus1btn, #plus2btn, #plus3btn, #plus4btn {
         font-size: 8vh;
         color: dodgerBlue;
         background-color: silver;
         border-radius: 5px;
         border: 1px solid #aaa;
         }
         .pnom {
         color: black;
         background-color: silver;
         border-radius: 5px;
         border: 1px solid #aaa;
         }
         .grid-container-top {
         display: grid;
         grid-template-columns: auto;
         }
         .grid-container-top > div
         {
         font-size: 4.5vh;
         display: flex;
         justify-content: center;
         align-items: center;
         text-align: center;
         border-radius: 5px;
         height: 10vh;
         color: white;
         background: dodgerBlue;
         border: 1px solid white;
         box-shadow: inset blue 0px 0px 60px -12px;	
         }
         .grid-container-middle
         {
         display: grid;
         grid-template-columns: auto calc(98vw/3);
         }
         .grid-container-middle > div
         {
         display: flex;
         justify-content: center;
         align-items: center;
         text-align: center;
         font-size: 2.5vh;
         border: 1px solid gainsboro;
         height: 10vh;
         }
         .grid-container-bottom
         {
         display: grid;
         grid-template-columns: calc(98vw/3) auto calc(98vw/3);
         }
         .grid-container-bottom > div
         {
         font-size: 5vh;
         display: flex;
         justify-content: center;
         align-items: center;
         text-align: center;
         border-radius: 5px;
         height: 10vh;	
         }
         #p1score,
         #p2score,
         #p3score,
         #p4score
         {
         font-size: 5vh;
         }
         .highlight
         {
         color: black;
         border: 1px solid black;
         box-shadow: inset black 0px 0px 60px -12px;
         }
         .scorelow
         {
         color: white;
         background: dodgerBlue;
         border: 1px solid white;
         box-shadow: inset blue 0px 0px 60px -12px;
         }
         .scorehigh
         {
         color: black;
         background: white;
         border: 1px solid black;
         box-shadow: inset black 0px 0px 60px -12px;
         }
         #info
         {
         display: none;
         overflow: auto;
         position: absolute;
         top: 1vh;
         left: 2vw;
         height: 93vh;
         width: 97vw;
         color: white;
         background-color: dimGray;
         opacity: 0.95;
         border-radius:10px;
         padding-left: 2px;
         padding-right: 2px;
         padding-bottom: 10px;
         box-shadow: inset black 0px 0px 60px -12px;
         }
         #p1h0, #p2h0, #p3h0, #p4h0 {
         padding-top: 5px;
         font-size: 2vh;
         padding-bottom: 5px;
         }
         #x1 {
         color: yellow;
         font-size: 2vh;
         }
         
         
         #id_recoverbtn,
    #id_clearbtn {
      background-color: #ccc;
      font-size: 4vh;
      display: inline-block;
      border-radius: 3px;
      border: 1px solid #aaa;
      padding: 10px;
      margin: 3px;
      text-align: center;
      //width: 75px;
      height: 50px;
      cursor: pointer;
    }
      
    #popuppanel {
    background-color: #ddd;
      font-size: 4vh;
      display: inline-block;
      border-radius: 3px;
      border: 1px solid #aaa;
      padding: 10px;
      margin: 20vw;
      text-align: center;
      width: 50vw;
      //height: 50px;
      cursor: pointer;
    }     
         
      </style>
   </head>
   <body>
      <div id="firstscreen">
         <div class="xxxwrapper">
            <div onclick="toggleDropdown();" class="dropbtn" id="dropbtn">tap to add player 1</div>
            <div id="playersDropdown" class="dropdown-content"></div>
            <div class="spacer1"></div>
            <div id="popuppanel"></div>
            <div id="hcpeditpopuppanel"></div>
            <div class="grid-container-frontscreen">
               <div id="player4ballplayer">no players have been added</div>
               <div id="player4ballname"></div>
               <div id="player4ballhcp"></div>
            </div>
            <div class="grid-container-frontscreen">
               <div class="spacer1"></div>
               <div class="spacer1"></div>
               <div class="spacer1"></div>
            </div>
            <div class="grid-container-frontscreen">
               <div></div>
               <div>
                  <button  id="startscoring" onclick="getScoring()">start scoring</button>
               </div>
               <div></div>
            </div>
            <div class="grid-container-frontscreen">
               <div class="spacer1"></div>
               <div class="spacer1"></div>
               <div class="spacer1"></div>
            </div>
            <div class="grid-container-frontscreen">
               <div><button id="dawsonbutton" onclick="chooseCourse(this.id)">Dawson</button></div>
               <div><button id="lakesbutton" onclick="chooseCourse(this.id)">Lakes</button></div>
               <div><button id="oldcoursebutton" onclick="chooseCourse(this.id)">OldCourse</button></div>
            </div>
            <div>
               <button id="edithcps" onclick="editHCPs()">edit handicaps</button>
            </div>
         </div>
      </div>
      <div id="all">
      <div class="grid-container-top">
         <div id="holedetails" onclick="displayInfo()"></div>
      </div>
      <div class="grid-container-middle">
         <div id="p1name" onclick="selected(this.id)">player 1</div>
         <div id="p1score" onclick="selected(this.id)">0</div>
         <div id="p2name" onclick="selected(this.id)">player 2</div>
         <div id="p2score" onclick="selected(this.id)">0</div>
         <div id="p3name" onclick="selected(this.id)">player 3</div>
         <div id="p3score" onclick="selected(this.id)">0</div>
         <div id="p4name" onclick="selected(this.id)">player 4</div>
         <div id="p4score" onclick="selected(this.id)">0</div>
      </div>
      <div class="grid-container-bottom">
         <div class="small scorelow" id="score1" onclick="numberScore(this.id)">1</div>
         <div class="small scorelow" id="score2" onclick="numberScore(this.id)">2</div>
         <div class="small scorelow" id="score3" onclick="numberScore(this.id)">3</div>
         <div class="small scorelow" id="score4" onclick="numberScore(this.id)">4</div>
         <div class="small scorelow" id="score5" onclick="numberScore(this.id)">5</div>
         <div class="small scorelow" id="score6" onclick="numberScore(this.id)">6</div>
         <div class="small scorelow" id="score7" onclick="numberScore(this.id)">7</div>
         <div class="small scorelow" id="score8" onclick="numberScore(this.id)">8</div>
         <div class="small scorelow" id="score9" onclick="numberScore(this.id)">9</div>
         <div class="small scorelow" id="scoreprev" onclick="prevHole()">prev</div>
         <div class="small scorelow" id="score0" onclick="numberScore(this.id)">0</div>
         <div class="small scorelow" id="scorenext" onclick="nextHole()">next</div>
      </div>
      <div id="info" onclick="hideInfo()">
         <div id="x1"></div>
         <div class="grid-container-popup">
            <div id="h0"></div>
            <div id="p1h0">player 1</div>
            <div id="p2h0">player 2</div>
            <div id="p3h0">player 3</div>
            <div id="p4h0">player 4</div>
            <div id="h1">1</div>
            <div id="p1h1">-</div>
            <div id="p2h1">-</div>
            <div id="p3h1">-</div>
            <div id="p4h1">-</div>
            <div id="h2">2</div>
            <div id="p1h2">-</div>
            <div id="p2h2">-</div>
            <div id="p3h2">-</div>
            <div id="p4h2">-</div>
            <div id="h3">3</div>
            <div id="p1h3">-</div>
            <div id="p2h3">-</div>
            <div id="p3h3">-</div>
            <div id="p4h3">-</div>
            <div id="h4">4</div>
            <div id="p1h4">-</div>
            <div id="p2h4">-</div>
            <div id="p3h4">-</div>
            <div id="p4h4">-</div>
            <div id="h5">5</div>
            <div id="p1h5">-</div>
            <div id="p2h5">-</div>
            <div id="p3h5">-</div>
            <div id="p4h5">-</div>
            <div id="h6">6</div>
            <div id="p1h6">-</div>
            <div id="p2h6">-</div>
            <div id="p3h6">-</div>
            <div id="p4h6">-</div>
            <div id="h7">7</div>
            <div id="p1h7">-</div>
            <div id="p2h7">-</div>
            <div id="p3h7">-</div>
            <div id="p4h7">-</div>
            <div id="h8">8</div>
            <div id="p1h8">-</div>
            <div id="p2h8">-</div>
            <div id="p3h8">-</div>
            <div id="p4h8">-</div>
            <div id="h9">9</div>
            <div id="p1h9">-</div>
            <div id="p2h9">-</div>
            <div id="p3h9">-</div>
            <div id="p4h9">-</div>
            <div id="front">front</div>
            <div id="p1hf">-</div>
            <div id="p2hf">-</div>
            <div id="p3hf">-</div>
            <div id="p4hf">-</div>
            <div id="h10">10</div>
            <div id="p1h10">-</div>
            <div id="p2h10">-</div>
            <div id="p3h10">-</div>
            <div id="p4h10">-</div>
            <div id="h11">11</div>
            <div id="p1h11">-</div>
            <div id="p2h11">-</div>
            <div id="p3h11">-</div>
            <div id="p4h11">-</div>
            <div id="h12">12</div>
            <div id="p1h12">-</div>
            <div id="p2h12">-</div>
            <div id="p3h12">-</div>
            <div id="p4h12">-</div>
            <div id="h13">13</div>
            <div id="p1h13">-</div>
            <div id="p2h13">-</div>
            <div id="p3h13">-</div>
            <div id="p4h13">-</div>
            <div id="h14">14</div>
            <div id="p1h14">-</div>
            <div id="p2h14">-</div>
            <div id="p3h14">-</div>
            <div id="p4h14">-</div>
            <div id="h15">15</div>
            <div id="p1h15">-</div>
            <div id="p2h15">-</div>
            <div id="p3h15">-</div>
            <div id="p4h15">-</div>
            <div id="h16">16</div>
            <div id="p1h16">-</div>
            <div id="p2h16">-</div>
            <div id="p3h16">-</div>
            <div id="p4h16">-</div>
            <div id="h17">17</div>
            <div id="p1h17">-</div>
            <div id="p2h17">-</div>
            <div id="p3h17">-</div>
            <div id="p4h17">-</div>
            <div id="h18">18</div>
            <div id="p1h18">-</div>
            <div id="p2h18">-</div>
            <div id="p3h18">-</div>
            <div id="p4h18">-</div>
            <div id="back">back</div>
            <div id="p1hb">-</div>
            <div id="p2hb">-</div>
            <div id="p3hb">-</div>
            <div id="p4hb">-</div>
            <div id="total">total</div>
            <div id="p1ht">-</div>
            <div id="p2ht">-</div>
            <div id="p3ht">-</div>
            <div id="p4ht">-</div>
         </div>
      </div>
      <script>  
//=================================================================================
// this runs on startup or reload
// 
//=================================================================================
// declare global variables
var selectedplayer = 1;
// hilight first player entry
document.getElementById("p1name").classList.add("highlight");
var arrCourse = [];
var arrHCPs = [];
var arrPlayers = [];
var compcourse = "none";
var compdate = "";
var shotsscore = "";
var currenthole = 0;
// declare global variables
var hcp = "0";
var player = "select player";
var comp;
var course = "OldCourse";
var arrOptions = [];
var hcplist = "";
var msglist = "";
var msglistcount = 0;
var player1name = "player 1";
var player2name = "player 2";
var player3name = "player 3";
var player4name = "player 4";
var player1hcp = "no hcp";
var player2hcp = "no hcp";
var player3hcp = "no hcp";
var player4hcp = "no hcp";
var originalhcp1 = 0;
var originalhcp2 = 0;
var originalhcp3 = 0;
var originalhcp4 = 0;
var whichhole = 1;
// set up courses with details for calculations etc.
// array ["hole num",par,si]
// Lakes
arrLakes = [
	[0, 0, 0],
	[1, 4, 15],
	[2, 4, 7],
	[3, 5, 3],
	[4, 4, 1],
	[5, 3, 17],
	[6, 3, 11],
	[7, 4, 9],
	[8, 4, 5],
	[9, 4, 13],
	[10, 3, 16],
	[11, 4, 18],
	[12, 4, 10],
	[13, 4, 6],
	[14, 3, 14],
	[15, 3, 4],
	[16, 5, 12],
	[17, 4, 2],
	[18, 5, 8]
];
// array ["hole num",par,si]
// Dawson
arrDawson = [
	[0, 0, 0],
	[1, 5, 13],
	[2, 4, 15],
	[3, 3, 17],
	[4, 4, 3],
	[5, 4, 1],
	[6, 5, 11],
	[7, 4, 7],
	[8, 4, 9],
	[9, 5, 5],
	[10, 4, 16],
	[11, 5, 14],
	[12, 3, 18],
	[13, 4, 2],
	[14, 4, 4],
	[15, 4, 12],
	[16, 3, 6],
	[17, 4, 10],
	[18, 4, 8]
];
// array ["hole num",par,si]
// OldCourse
arrOldCourse = [
	[0, 0, 0],
	[1, 5, 10],
	[2, 4, 6],
	[3, 3, 18],
	[4, 5, 4],
	[5, 3, 16],
	[6, 4, 2],
	[7, 4, 14],
	[8, 4, 8],
	[9, 4, 12],
	[10, 4, 5],
	[11, 3, 13],
	[12, 4, 15],
	[13, 4, 1],
	[14, 5, 7],
	[15, 3, 11],
	[16, 5, 9],
	[17, 4, 3],
	[18, 5, 17]
];
// 1st hole
var holedetails = "hole " + arrOldCourse[whichhole][0] + ", par " + arrOldCourse[whichhole][1] + 
", si " + arrOldCourse[whichhole][2]
document.getElementById("holedetails").innerText = holedetails
	//===========================
	// this code runs at startup
	//===========================
	//==============================================================
	// data has previously been stored so just retrieve it
	//==============================================================
	// retrieve arrays
if("xplayersarray" in localStorage) {
	arrPlayers = JSON.parse(localStorage.xplayersarray);
}
if("xhcparray" in localStorage) {
	arrHCPs = JSON.parse(localStorage.xhcparray);
}

showDownloadingInfoMsg();

startNewDay();
//=============================================================
// functions - run when called
//=============================================================  
function startNewDay() {
	// get todays date eg 26 June
	dd = new Date();
	// get date number and format it
	d1 = dd.getDate();
	if(d1 < 10) {
		d1 = "0" + d1;
	}
	// get month and format it
	d2 = dd.getMonth();
	if(d2 == 0) {
		m = "January";
	}
	if(d2 == 1) {
		m = "February";
	}
	if(d2 == 2) {
		m = "March";
	}
	if(d2 == 3) {
		m = "April";
	}
	if(d2 == 4) {
		m = "May";
	}
	if(d2 == 5) {
		m = "June";
	}
	if(d2 == 6) {
		m = "July";
	}
	if(d2 == 7) {
		m = "August";
	}
	if(d2 == 8) {
		m = "September";
	}
	if(d2 == 9) {
		m = "October";
	}
	if(d2 == 10) {
		m = "November";
	}
	if(d2 == 11) {
		m = "December";
	}
	dateToday = d1 + " " + m;
	dstored = d1 + "-" + d2
	compdate = d1 + " " + m;
	if(localStorage.xcompdate !== compdate) {
		// create set of local storage items	
		setupScores()
	}
	// doublecheck ??    
	if("xcomp" in localStorage) {
		// if its a new comp
		if(localStorage.xcomp.indexOf(dateToday) < 0) {
			localStorage.removeItem("xcomp");
			localStorage.removeItem("xcourse");
			localStorage.removeItem("xplayer");
			localStorage.removeItem("xhcp");
			localStorage.setItem("xdstored", dstored);
		}
	}
}

async function getData() {
	var dataStream = 
	await fetch("https://opensheet.elk.sh/1xeS22CrN3Mdq2nRQLACDBN7iaMSBJ7MM1PX7gikWOJM/sweepcsv")
	var resultsarray = await dataStream.json();
	// get rid of blanks in array by creating new arrays
	for(var i = 0; i < resultsarray.length; i++) {
		if(resultsarray[i].player.length > 2) {
			arrPlayers.push(resultsarray[i].player);
			arrHCPs.push(resultsarray[i].hcp);
		}
	}
	document.getElementById("popuppanel").style.display = "none";
	start();
	showRecoverChoice()
}
getData()
	//=============================================================
	//=============================================================
	// function start()
	// - initialise everything and do checks etc.
	//=============================================================  
function start() {
	// bring most commonly selected to the top
	//arrPlayers.sort(compareSecondColumn);
	// create player dropdown
	var select = document.getElementById("playersDropdown");
	// this is what is created
	//<a id="myLink1" href="#" onclick='dropSelected(this.innerText);return false;'>Graham Airey</a>
	//
	for(var i = 0; i < arrPlayers.length; i++) {
		var el = document.createElement("a");
		el.id = "myLink" + (i);
		el.setAttribute("onclick", "dropSelected(this.innerText);return false;");
		el.setAttribute("href", "#");
		el.innerText = arrPlayers[i];
		select.appendChild(el);
	}
	// Close the dropdown if the user clicks outside of it
	window.onclick = function(event) {
		if(!event.target.matches('.dropbtn')) {
			var dropdowns = document.getElementsByClassName("dropdown-content");
			var i;
			for(i = 0; i < dropdowns.length; i++) {
				var openDropdown = dropdowns[i];
				if(openDropdown.classList.contains('show')) {
					openDropdown.classList.remove('show');
				}
			}
		}
	};
	// get todays date eg 26 June
	dd = new Date();
	// get date number and format it
	d1 = dd.getDate();
	if(d1 < 10) {
		d1 = "0" + d1;
	}
	// get month and format it
	d2 = dd.getMonth();
	if(d2 == 0) {
		m = "January";
	}
	if(d2 == 1) {
		m = "February";
	}
	if(d2 == 2) {
		m = "March";
	}
	if(d2 == 3) {
		m = "April";
	}
	if(d2 == 4) {
		m = "May";
	}
	if(d2 == 5) {
		m = "June";
	}
	if(d2 == 6) {
		m = "July";
	}
	if(d2 == 7) {
		m = "August";
	}
	if(d2 == 8) {
		m = "September";
	}
	if(d2 == 9) {
		m = "October";
	}
	if(d2 == 10) {
		m = "November";
	}
	if(d2 == 11) {
		m = "December";
	}
	compdate = d1 + " " + m;
} // end function start()
//=============================================================
// functions - run when called
//=============================================================  
//=============================================================
// function resetNames()
// - gets rid of "selected" names
//=============================================================  
function resetNames() {
	// create player dropdown
	var select = document.getElementById("playersDropdown");
	// empty names
	select.innerHTML = "";
	// redo list for menu
	// <a id="myLink1" href="#" onclick='dropSelected(this.innerText);return false;'>Graham Airey</a>
	//
	for(var i = 0; i < arrPlayers.length; i++) {
		var el = document.createElement("a");
		el.id = "myLink" + (i + 1);
		el.setAttribute("onclick", "dropSelected(this.innerText);return false;");
		el.setAttribute("href", "#");
		el.innerText = arrPlayers[i];
		select.appendChild(el);
	}
}
// name selected, do stuff
function dropSelected(playerName) {
	// retrieve dropdown info
	for(var k = 0; k < arrPlayers.length; k++) {
		if(arrPlayers[k] == playerName) {
			found = true;
			pos = k;
		}
	}
	// change color on selection
	document.getElementById("myLink" + pos.toString()).style.color = "blue";
	document.getElementById("myLink" + pos.toString()).style.background = "lightBlue";
	// update player choice
	player = document.getElementById("myLink" + pos.toString()).innerText;
	outputPlayers(player)
		// close dropdown
	var dropdowns = document.getElementsByClassName("dropdown-content");
	var i;
	for(i = 0; i < dropdowns.length; i++) {
		var openDropdown = dropdowns[i];
		if(openDropdown.classList.contains('show')) {
			openDropdown.classList.remove('show');
		}
	}
}
//=============================================================
// function toggleDropdown()
// - show player name choices
//=============================================================  
function toggleDropdown() {
	// When the user clicks on the button, toggle between hiding and showing the dropdown content
	document.getElementById("playersDropdown").classList.toggle("show");
}
//=============================================================
// function showDownloadingInfoMsg()
// - show message when downloading player and course info and creating arrays
//=============================================================  
function showDownloadingInfoMsg() {
	document.getElementById("popuppanel").innerHTML = 
	'<br>Retrieving Course and Player information.<br><br><img src="throbber.gif" width=50 height=48>';
	document.getElementById("popuppanel").style.display = "block";
}

function shortName(nom) {
	// shorten player name
	s1 = nom.split(" ")
	shortPlayername = s1[0] + " " + s1[1].substring(0, 1);
	shortPlayername = shortPlayername.replace("Stephen", "Steve")
	shortPlayername = shortPlayername.replace("Malcolm", "Mal")
	return shortPlayername;
}

function body() {
if (player1hcp == "no hcp") {
    player1hcp = 99;
}
if (player2hcp == "no hcp") {
    player2hcp = 99;
}
if (player3hcp == "no hcp") {
    player3hcp = 99;
}
if (player4hcp == "no hcp") {
    player4hcp = 99;
}
x = Math.min((player1hcp*0.9), (player2hcp*0.9), (player3hcp*0.9), (player4hcp*0.9))
x1 = ((player1hcp*0.9) - x).toFixed(0)
x2 = ((player2hcp*0.9) - x).toFixed(0)
x3 = ((player3hcp*0.9) - x).toFixed(0)
x4 = ((player4hcp*0.9) - x).toFixed(0)

y1array = player1name.split(" ")
y2array = player2name.split(" ")
y3array = player3name.split(" ")
y4array = player4name.split(" ")

document.getElementById("p1name").innerText = shortName(player1name) + " (" + player1hcp + ") " + x1 + " shots";
document.getElementById("p2name").innerText = shortName(player2name) + " (" + player2hcp + ") " + x2 + " shots";
document.getElementById("p3name").innerText = shortName(player3name) + " (" + player3hcp + ") " + x3 + " shots";
document.getElementById("p4name").innerText = shortName(player4name) + " (" + player4hcp + ") " + x4 + " shots";
}
//=================================================================================
// highlight the current player number
// 
//=================================================================================	
function selected(id) {
	// reset all player names
	document.getElementById("p1name").classList.remove("highlight");
	document.getElementById("p2name").classList.remove("highlight");
	document.getElementById("p3name").classList.remove("highlight");
	document.getElementById("p4name").classList.remove("highlight");
	// highlight selected
	selectedplayer = id.replace("score", "").replace("name", "").replace("p", "")
	document.getElementById("p" + selectedplayer + "name").classList.add("highlight");
}
//=================================================================================
// put score in the selected player
// and move on	
//=================================================================================
function numberScore(id) {
	// id is something like score2
	// selectedplayer is global 1, 2, 3, 4
	if(("1234").indexOf(selectedplayer) > -1) {
		// id is number button pressed eg. score5
		temppscore = "p" + selectedplayer + "score"
		temppname = "p" + selectedplayer + "name"
			// highlight number button for a brief time
		tempid = document.getElementById(id)
		temppscoreid = document.getElementById(temppscore)
		temppnameid = document.getElementById(temppname)
			// do number button
		tempid.classList.replace("scorelow", "scorehigh");
		// do score entered
		temppscoreid.classList.add("highlight");
		// do player name
		temppnameid.classList.add("highlight");
		// delay putting everything back
		setTimeout(() => {
			// put number button back
			tempid.classList.replace("scorehigh", "scorelow");
			// put score back
			temppscoreid.classList.remove("highlight");
			// put player name back
			temppnameid.classList.remove("highlight");
			// update score
			document.getElementById(temppscore).innerText = id.replace("score", "")
				// move on to next player and highlight
			selectedplayer++
			if(selectedplayer <= 4) {
				tempstrokesid = document.getElementById("p" + selectedplayer + "name")
				tempstrokesid.classList.add("highlight");
			} else {
				selectedplayer = 0
			}
		}, "100");
	}
}
//=================================================================================
// move to next hole
// 
//=================================================================================
function nextHole() {
	saveScores()
	document.getElementById("scorenext").classList.replace("scorelow", "scorehigh");
	// delay putting everything back
	setTimeout(() => {
		// put number button back
		document.getElementById("scorenext").classList.replace("scorehigh", "scorelow");
	}, "250");
	whichhole++
	if (whichhole > 18) {
	    whichhole = 18;
	}
	holedetails = "hole " + arrOldCourse[whichhole][0] + ", par " + arrOldCourse[whichhole][1] + 
	", si " + arrOldCourse[whichhole][2]
		// get hole details
	document.getElementById("holedetails").innerText = holedetails
		// get hole scores
	document.getElementById("p1h" + whichhole).innerText = localStorage.getItem("xp1h" + whichhole);
	document.getElementById("p2h" + whichhole).innerText = localStorage.getItem("xp2h" + whichhole);
	document.getElementById("p3h" + whichhole).innerText = localStorage.getItem("xp3h" + whichhole);
	document.getElementById("p4h" + whichhole).innerText = localStorage.getItem("xp4h" + whichhole);
	// reset all player name backgrounds
	document.getElementById("p1name").classList.remove("highlight");
	document.getElementById("p2name").classList.remove("highlight");
	document.getElementById("p3name").classList.remove("highlight");
	document.getElementById("p4name").classList.remove("highlight");
	document.getElementById("p1score").innerText = "0"
	document.getElementById("p2score").innerText = "0"
	document.getElementById("p3score").innerText = "0"
	document.getElementById("p4score").innerText = "0"
	selectedplayer = 1
	document.getElementById("p1name").classList.add("highlight");
	// get scores  
	getScores()
}
//=================================================================================
// move to the previous hole
//
//=================================================================================
function prevHole() {
	saveScores()
	document.getElementById("scoreprev").classList.replace("scorelow", "scorehigh");
	// delay putting everything back
	setTimeout(() => {
		// put number button back
		document.getElementById("scoreprev").classList.replace("scorehigh", "scorelow");
	}, "250");
	whichhole--
	if (whichhole < 1) {
	    whichhole = 1
	}
	// get hole details
	holedetails = "hole " + arrOldCourse[whichhole][0] + ", par " + arrOldCourse[whichhole][1] + 
	", si " + arrOldCourse[whichhole][2]
	document.getElementById("holedetails").innerText = holedetails
		// get hole scores
	document.getElementById("p1h" + whichhole).innerText = localStorage.getItem("xp1h" + whichhole);
	document.getElementById("p2h" + whichhole).innerText = localStorage.getItem("xp2h" + whichhole);
	document.getElementById("p3h" + whichhole).innerText = localStorage.getItem("xp3h" + whichhole);
	document.getElementById("p4h" + whichhole).innerText = localStorage.getItem("xp4h" + whichhole);
	// change highlight colour
	document.getElementById("p1name").classList.remove("highlight");
	document.getElementById("p2name").classList.remove("highlight");
	document.getElementById("p3name").classList.remove("highlight");
	document.getElementById("p4name").classList.remove("highlight");
	selectedplayer = 1
	document.getElementById("p1name").classList.add("highlight");
	// retrieve scores   
	getScores()
}
//=================================================================================
// create an empty set of local storage score containers
// and move on	
//=================================================================================
function setupScores() {
	// do date check here
	console.log((localStorage.xcompdate !== compdate))
	if(localStorage.xcompdate !== compdate) {
		for(var i = 1; i <= 18; i++) {
			for(var j = 1; j <= 4; j++) {
				localStorage.setItem("xp" + j + "h" + i, "0")
			}
		}
		localStorage.xcompdate = compdate;
	}
}
//=================================================================================
// save scores for a single page to local storage
// 
//=================================================================================
function saveScores() {
	// only save if scores are there
	if(!(document.getElementById("p1score").innerText == "0" && 
	     document.getElementById("p2score").innerText == "0" && 
	     document.getElementById("p3score").innerText == "0" && 
	     document.getElementById("p4score").innerText == "0")) {
		localStorage.setItem("xp1h" + whichhole, document.getElementById("p1score").innerText)
		localStorage.setItem("xp2h" + whichhole, document.getElementById("p2score").innerText)
		localStorage.setItem("xp3h" + whichhole, document.getElementById("p3score").innerText)
		localStorage.setItem("xp4h" + whichhole, document.getElementById("p4score").innerText)
	}
}
//=================================================================================
// get scores for a single page from local storage
// 
//=================================================================================
function getScores() {
	document.getElementById("p1score").innerText = localStorage.getItem("xp1h" + whichhole)
	document.getElementById("p2score").innerText = localStorage.getItem("xp2h" + whichhole)
	document.getElementById("p3score").innerText = localStorage.getItem("xp3h" + whichhole)
	document.getElementById("p4score").innerText = localStorage.getItem("xp4h" + whichhole)
}

function outputPlayers(msg) {
	// msg is player name eg "Bryan Maddison"
	// find HCP
	var hcp;
	for(var i = 0, len = arrPlayers.length; i < len; i++) {
		if(arrPlayers[i] === msg) {
			hcp = arrHCPs[i];
			break;
		}
	}
	msglistcount++
	if(msglistcount > 4) {
		console.log("too many players")
	} else {
		if(hcplist == "") {
			hcplist = hcp;
		} else {
			hcplist += "#" + hcp
		}
	}
	hcplistx = hcplist + "#no hcp#no hcp#no hcp#ho hcp#no hcp"
	arr2 = hcplistx.split("#");
	player1hcp = arr2[0];
	player2hcp = arr2[1];
	player3hcp = arr2[2];
	player4hcp = arr2[3];
	if(msglistcount > 4) {
		console.log("too many players")
	} else {
		if(msglist == "") {
			msglist = msg;
			// enable scoring button if player there and ourse chosen
			if(compcourse !== "none") {
				document.getElementById("startscoring").style.display = "block";
			}
		} else {
			msglist += "#" + msg
		}
	}
	msglistx = msglist + "#no player#no player#no player#no player#no player"
	arr1 = msglistx.split("#");
	newmsglistplayer = "Player 1:" + "<br>" + "Player 2:" + "<br>" + "Player 3:" + "<br>" + "Player 4:"
	newmsglistname = arr1[0] + "<br>" + arr1[1] + "<br>" + arr1[2] + "<br>" + arr1[3]
	newmsglisthcp = player1hcp + "<br>" + player2hcp + "<br>" + player3hcp + "<br>" + player4hcp
	newmsglist = "Player 1: " + arr1[0] + "<br>" + "Player 2: " + arr1[1] + "<br>" + "Player 3: " + 
	arr1[2] + "<br>" + "Player 4: " + arr1[3]
	document.getElementById("player4ballplayer").innerHTML = newmsglistplayer
	document.getElementById("player4ballname").innerHTML = newmsglistname
	document.getElementById("player4ballhcp").innerHTML = newmsglisthcp
		// add players names
	player1name = arr1[0]
	player2name = arr1[1]
	player3name = arr1[2]
	player4name = arr1[3]
	if(arr1[3] == "no player") {
		txt = "tap to add player 4"
	}
	if(arr1[2] == "no player") {
		txt = "tap to add player 3"
	}
	if(arr1[1] == "no player") {
		txt = "tap to add player 2"
	}
	if(arr1[0] == "no player") {
		txt = "tap to add player 1"
	}
	document.getElementById("dropbtn").innerText = txt;
	// just close it now
	if(arr1[3] !== "no player") {
		// hide button
		document.getElementById("dropbtn").style.display = "none";
	}
	body();
}

function chooseCourse(id) {
	document.getElementById("dawsonbutton").style.opacity = "0.3";
	document.getElementById("lakesbutton").style.opacity = "0.3";
	document.getElementById("oldcoursebutton").style.opacity = "0.3";
	document.getElementById(id).style.opacity = "1.0";
	compcourse = id.replace("button", "");
	compcourse = compcourse.replace("dawson", "Dawson")
	compcourse = compcourse.replace("lakes", "Lakes")
	compcourse = compcourse.replace("oldcourse", "OldCourse")
		// choose course
	if(compcourse == "Dawson") {
		arrCourse = arrDeepCopy(arrDawson);
	}
	if(compcourse == "Lakes") {
		arrCourse = arrDeepCopy(arrLakes);
	}
	if(compcourse == "OldCourse") {
		arrCourse = arrDeepCopy(arrOldCourse);
	}
	if(document.getElementById("player4ballplayer").innerText !== "no players have been added") {
		document.getElementById("startscoring").style.display = "block";
	}
	// update button to show course
	//	document.getElementById("coll0").innerText = "Scores for " + compcourse;
}
// helper function to deep copy array
function arrDeepCopy(aObject) {
	// deep copy array
	// Prevent undefined objects
	// if (!aObject) return aObject;
	var bObject = Array.isArray(aObject) ? [] : {};
	var value;
	for(const key in aObject) {
		// Prevent self-references to parent object
		// if (Object.is(aObject[key], aObject)) continue;
		value = aObject[key];
		bObject[key] = (typeof value === "object") ? arrDeepCopy(value) : value;
	}
	return bObject;
}

function getScoring() {
        // update hcps in case they have been edited
        body();
        // set up for correct number of players
        if (player4name == "no player") {
            player4hcp = 99;
            document.getElementById("p4name").style.display = "none";
            document.getElementById("p4score").style.display = "none"   
        }
        if (player3name == "no player") {
            player3hcp = 99;
            document.getElementById("p3name").style.display = "none";
            document.getElementById("p3score").style.display = "none"   
        }
        if (player2name == "no player") {
            player2hcp - 99;
            document.getElementById("p2name").style.display = "none";
            document.getElementById("p2score").style.display = "none"   
        }
        if (player1name == "no player") {
            player1hcp = 99;
            document.getElementById("p1name").style.display = "none";
            document.getElementById("p1score").style.display = "none"   
        }
        
        
        
	document.getElementById("firstscreen").classList.add("fadeOut");
	setTimeout(() => {
		document.getElementById("firstscreen").style.display = "none";
	}, "1000");
	document.getElementById("all").style.display = "initial"
		// set up for correct number of players
		// initial save of data
	saveAllToLocalStorage()
}

function displayInfo() {
	saveScores();
	//saveAllToLocalStorage()
	// get players, all strokes and points
	document.getElementById("p1h0").innerText = shortName(player1name);
	document.getElementById("p2h0").innerText = shortName(player2name);
	document.getElementById("p3h0").innerText = shortName(player3name);
	document.getElementById("p4h0").innerText = shortName(player4name);
	for(var i = 1; i <= 18; i++) {
		temp = localStorage.getItem("xp1h" + i)
		document.getElementById("p1h" + i).innerText = temp + "/" + 
		pointsCalc(player1hcp, arrCourse[i][1], arrCourse[i][2], temp)
		temp = localStorage.getItem("xp2h" + i)
		document.getElementById("p2h" + i).innerText = temp + "/" + 
		pointsCalc(player2hcp, arrCourse[i][1], arrCourse[i][2], temp)
		temp = localStorage.getItem("xp3h" + i)
		document.getElementById("p3h" + i).innerText = temp + "/" + 
		pointsCalc(player3hcp, arrCourse[i][1], arrCourse[i][2], temp)
		temp = localStorage.getItem("xp4h" + i)
		document.getElementById("p4h" + i).innerText = temp + "/" + 
		pointsCalc(player4hcp, arrCourse[i][1], arrCourse[i][2], temp)
	}
	totalScore()
	shots()
		// show screen as overlay
	if(document.getElementById("info").style.display !== "block") {
		document.getElementById("info").style.display = "block"
	} else {
		document.getElementById("info").style.display = "none"
	}
}

function hideInfo() {
	document.getElementById("info").style.display = "none"
}
// calculated additional totals, countback etc.
function totalScore() {
	// front 9 scores
	var p1ih = 0;
	var p2ih = 0;
	var p3ih = 0;
	var p4ih = 0;
	// front 9 points
	var p1ip = 0;
	var p2ip = 0;
	var p3ip = 0;
	var p4ip = 0;
	// back 9 scores
	var p1jh = 0;
	var p2jh = 0;
	var p3jh = 0;
	var p4jh = 0;
	// back 9 points
	var p1jp = 0;
	var p2jp = 0;
	var p3jp = 0;
	var p4jp = 0;
	// totals
	var p1f = 0;
	var p1b = 0;
	var p1t = 0;
	var p2f = 0;
	var p2b = 0;
	var p2t = 0;
	var p3f = 0;
	var p3b = 0;
	var p3t = 0;
	var p4f = 0;
	var p4b = 0;
	var p4t = 0;
	// do scores and points
	for(i = 1; i <= 9; i++) {
		//const [name, street, unit, city, state, zip] = input.split("/");
		var [tempp1ih, tempp1ip] = document.getElementById("p1h" + i).innerText.split("/");
		var [tempp2ih, tempp2ip] = document.getElementById("p2h" + i).innerText.split("/");
		var [tempp3ih, tempp3ip] = document.getElementById("p3h" + i).innerText.split("/");
		var [tempp4ih, tempp4ip] = document.getElementById("p4h" + i).innerText.split("/");
		p1ih += parseInt(tempp1ih)
		p2ih += parseInt(tempp2ih)
		p3ih += parseInt(tempp3ih)
		p4ih += parseInt(tempp4ih)
		p1ip += parseInt(tempp1ip)
		p2ip += parseInt(tempp2ip)
		p3ip += parseInt(tempp3ip)
		p4ip += parseInt(tempp4ip)
	}
	for(j = 10; j <= 18; j++) {
		//const [name, street, unit, city, state, zip] = input.split("/");
		var [tempp1jh, tempp1jp] = document.getElementById("p1h" + j).innerText.split("/");
		var [tempp2jh, tempp2jp] = document.getElementById("p2h" + j).innerText.split("/");
		var [tempp3jh, tempp3jp] = document.getElementById("p3h" + j).innerText.split("/");
		var [tempp4jh, tempp4jp] = document.getElementById("p4h" + j).innerText.split("/");
		p1jh += parseInt(tempp1jh)
		p2jh += parseInt(tempp2jh)
		p3jh += parseInt(tempp3jh)
		p4jh += parseInt(tempp4jh)
		p1jp += parseInt(tempp1jp)
		p2jp += parseInt(tempp2jp)
		p3jp += parseInt(tempp3jp)
		p4jp += parseInt(tempp4jp)
	}
	p1f = p1ih + p1jh;
	p2f = p2ih + p2jh;
	p3f = p3ih + p3jh;
	p4f = p4ih + p4jh;
	p1fp = p1ip + p1jp;
	p2fp = p2ip + p2jp;
	p3fp = p3ip + p3jp;
	p4fp = p4ip + p4jp;
	document.getElementById("p1hf").innerText = p1ih + "/" + p1ip;
	document.getElementById("p2hf").innerText = p2ih + "/" + p2ip;
	document.getElementById("p3hf").innerText = p3ih + "/" + p3ip;
	document.getElementById("p4hf").innerText = p4ih + "/" + p4ip;
	document.getElementById("p1hb").innerText = p1jh + "/" + p1jp;
	document.getElementById("p2hb").innerText = p2jh + "/" + p1jp;
	document.getElementById("p3hb").innerText = p3jh + "/" + p1jp;
	document.getElementById("p4hb").innerText = p4jh + "/" + p1jp;
	document.getElementById("p1ht").innerText = p1f + "/" + p1fp;
	document.getElementById("p2ht").innerText = p2f + "/" + p2fp;
	document.getElementById("p3ht").innerText = p3f + "/" + p3fp;
	document.getElementById("p4ht").innerText = p4f + "/" + p4fp;
}
// convert scores to stableford points
function pointsCalc(hcp, par, si, score) {
	allowance = 0;
	if(score == 0) {
		return 0;
	} else {
		// allowance   
		if(hcp >= si) {
			allowance = 1;
		}
		if(hcp >= (18 + si)) {
			allowance = 2;
		}
		if(hcp >= (36 + si)) {
			allowance = 3;
		}
		// points
		var points = (par + allowance + 2) - score;
		// remove negative numbers
		if(points < 0) {
			points = 0;
		}
		return points;
	}
}

function shots() {
	shotsscore = "";
	shotsscoreTotal = "";
	msgss1 = 0
	msgss2 = 0
	msgss1saved = 0
	msgss2saved = 0
	msg = "msg empty"
	temp1 = 99
	temp2 = 99
	temp3 = 99
	temp4 = 99
	if(player1hcp !== "no hcp") {
		temp1 = (player1hcp * 0.9)
	} else {
		temp1 = 99
	}
	if(player2hcp !== "no hcp") {
		temp2 = (player2hcp * 0.9)
	} else {
		temp2 = 99
	}
	if(player3hcp !== "no hcp") {
		temp3 = (player3hcp * 0.9)
	} else {
		temp3 = 99
	}
	if(player4hcp !== "no hcp") {
		temp4 = (player4hcp * 0.9)
	} else {
		temp4 = 99
	}
	temp1 = Math.round(temp1);
	temp2 = Math.round(temp2);
	temp3 = Math.round(temp3);
	temp4 = Math.round(temp4);
	tempmin = Math.min(temp1, temp2, temp3, temp4);
	shots1 = Math.round(temp1 - tempmin);
	shots2 = Math.round(temp2 - tempmin);
	shots3 = Math.round(temp3 - tempmin);
	shots4 = Math.round(temp4 - tempmin);
	for(i = 1; i <= 18; i++) {
		p1xtrashots = 0;
		p2xtrashots = 0;
		p3xtrashots = 0;
		p4xtrashots = 0;
		if(shots1 >= arrCourse[i][2] && shots1 < 54) {
			p1xtrashots = 1;
			if(shots1 >= (arrCourse[i][2] + 18)) {
				p1xtrashots++
			}
		}
		if(shots2 >= arrCourse[i][2] && shots2 < 54) {
			p2xtrashots = 1;
			if(shots2 >= (arrCourse[i][2] + 18)) {
				p2xtrashots++
			}
		}
		if(shots3 >= arrCourse[i][2] && shots3 < 54) {
			p3xtrashots = 1;
			if(shots3 >= (arrCourse[i][2] + 18)) {
				p3xtrashots++
			}
		}
		if(shots4 >= arrCourse[i][2] && shots4 < 54) {
			p4xtrashots = 1;
			if(shots4 >= (arrCourse[i][2] + 18)) {
				p4xtrashots++
			}
		}
		// calc score using "shots"
		var [p1shotsscore, temp1] = document.getElementById("p1h" + i).innerText.split("/");
		var [p2shotsscore, temp2] = document.getElementById("p2h" + i).innerText.split("/");
		var [p3shotsscore, temp3] = document.getElementById("p3h" + i).innerText.split("/");
		var [p4shotsscore, temp4] = document.getElementById("p4h" + i).innerText.split("/");
		notplayed = 0
			// cope with score of 0
		if(p1shotsscore == 0) {
			p1shotsscore = 99;
			notplayed++
		}
		if(p2shotsscore == 0) {
			p2shotsscore = 99;
			notplayed++
		}
		if(p3shotsscore == 0) {
			p3shotsscore = 99;
			notplayed++
		}
		if(p4shotsscore == 0) {
			p4shotsscore = 99;
			notplayed++
		}
		// if hole has a score
		if(notplayed !== 4) {
			p1shotsscore = (p1shotsscore - p1xtrashots)
			p2shotsscore = (p2shotsscore - p2xtrashots)
			p3shotsscore = (p3shotsscore - p3xtrashots)
			p4shotsscore = (p4shotsscore - p4xtrashots)
			t1win = 0
			t2win = 0
			tempmin = Math.min(p1shotsscore, p2shotsscore, p3shotsscore, p4shotsscore);
			tempmincount = 0
			if(p1shotsscore == tempmin) {
				tempmincount++
				t1win++
			}
			if(p2shotsscore == tempmin) {
				tempmincount++
				t1win++
			}
			if(p3shotsscore == tempmin) {
				tempmincount++
				t2win++
			}
			if(p4shotsscore == tempmin) {
				tempmincount++
				t2win++
			}
			t1 = shortName(player1name).slice(0, -2) + "/" + shortName(player2name).slice(0, -2)
			t2 = shortName(player3name).slice(0, -2) + "/" + shortName(player4name).slice(0, -2)
				// draw
			if(t1win > 0 && t2win > 0) {
				// halved hole
				msg = "halved"
			}
			// win
			if(t1win > 0 && t2win == 0) {
				// t1win hole
				msg = t1 + " win"
				msgss1++
			}
			// lose
			if(t2win > 0 && t1win == 0) {
				// t2win hole
				msg = t2 + " win"
				msgss2++
			}
			if(msgss1 == msgss2) {
				msgss = " (all square)"
			}
			if(msgss1 > msgss2) {
				msgss = " (" + t1 + " " + (msgss1 - msgss2) + " up)"
			}
			if(msgss2 > msgss1) {
				msgss = " (" + t2 + " " + (msgss2 - msgss1) + " up)"
			}
			// build text lines 
			shotsscore = shotsscore + "\n" + "hole " + i + " " + msg + msgss
			shotsscoreTotal = "\nmatch all square"
			if((msgss1 + msgss1saved) > (msgss2 + msgss2saved)) {
				shotsscoreTotal = "\n" + t1 + " wins match (" + 
				(msgss1 - msgss2 + msgss1saved - msgss2saved) + " up)"
				
				shotsscoreMatch = 
				"\n" + t1 + " " + (msgss1 - msgss2 + msgss1saved - msgss2saved) + " up in match"
			}
			if((msgss2 + msgss2saved) > (msgss1 + msgss1saved)) {
				shotsscoreTotal = "\n" + t2 + " wins match (" + 
				(msgss2 - msgss1 + msgss2saved - msgss1saved) + " up)"
			
				shotsscoreMatch = 
				"\n" + t2 + " " + (msgss2 - msgss1 + msgss2saved - msgss1saved) + " up in match"
			}
			if(i == 9) {
				msgss1saved = msgss1;
				msgss2saved = msgss2;
				msgss1 = 0;
				msgss2 = 0;
				shotsscore = shotsscore + "\n"
				if(msgss !== " (all square)") {
winfront9 = msgss.replace("(", "").replace(")", "").replace(" ", "").replace(" ", " wins front 9 (") + ")"
				} else {
winfront9 = msgss.replace("(", "").replace(")", "") + " front 9"
				}
			}
			if(i == 18) {
				if(msgss !== " (all square)") {
winback9 = msgss.replace("(", "").replace(")", "").replace(" ", "").replace(" ", " wins back 9 (") + ")"
				} else {
winback9 = msgss.replace("(", "").replace(")", "") + " back 9"
				}
				//shotsscoreTotal = shotsscoreTotal + "\n" + "hole " + i + " " + msg + msgss
				//shotsscore = 
				//shotsscore + "\n" + shotsscoreTotal + "\n" + winfront9 + "\n" + winback9
			}
			document.getElementById("x1").innerText = shotsscore
			if (i == 18) {
			    document.getElementById("x1").innerText = shotsscore + "\n" + shotsscoreTotal +
			    "\n" + winfront9 + "\n" + winback9
			}
			if (i > 9 && i < 18) {
			    document.getElementById("x1").innerText = shotsscore + "\n" + shotsscoreMatch + "\n"
			}
                }
	}
}

function editHCPs() {
	if(document.getElementById("player4ballplayer").innerText !== "no players have been added") {
		before = document.getElementById("player4ballhcp").innerHTML
		arrbefore = before.split("<br>")
		tempt = '<br />Edit hcps.';
		tempt += '<br /><br />';
		tempt += '<div class="grid-container-mini">'
		tempt += '<div class="pnom">' + player1name.substring(0, player1name.indexOf(' ')) + '</div>'
		tempt += '<div id="minus1btn" onclick="hcpMinus(this.id)">-</div>';
		tempt += '<div id="hcp1btn">' + arrbefore[0] + '</div>';
		tempt += '<div id="plus1btn" onclick="hcpPlus(this.id)">+</div>';
		//tempt += '<br /><br />';
		tempt += '<div class="pnom">' + player2name.substring(0, player2name.indexOf(' ')) + '</div>'
		tempt += '<div id="minus2btn" onclick="hcpMinus(this.id)">-</div>';
		tempt += '<div id="hcp2btn">' + arrbefore[1] + '</div>';
		tempt += '<div id="plus2btn" onclick="hcpPlus(this.id)">+</div>';
		//  tempt += '<br /><br />';
		tempt += '<div class="pnom">' + player3name.substring(0, player3name.indexOf(' ')) + '</div>'
		tempt += '<div id="minus3btn" onclick="hcpMinus(this.id)">-</div>';
		tempt += '<div id="hcp3btn">' + arrbefore[2] + '</div>';
		tempt += '<div id="plus3btn" onclick="hcpPlus(this.id)">+</div>';
		//   tempt += '<br /><br />';
		tempt += '<div class="pnom">' + player4name.substring(0, player4name.indexOf(' ')) + '</div>'
		tempt += '<div id="minus4btn" onclick="hcpMinus(this.id)">-</div>';
		tempt += '<div id="hcp4btn">' + arrbefore[3] + '</div>';
		tempt += '<div id="plus4btn" onclick="hcpPlus(this.id)">+</div>';
		tempt += '</div>'
		tempt += '<br /><br />';
		tempt += '<button id="finishbutton" onclick="finishHcpEdit()">finish</button>';
		tempt += '<br /><br />';
		document.getElementById("hcpeditpopuppanel").innerHTML = tempt;
		document.getElementById("hcpeditpopuppanel").style.display = "block";
	} // end if      
}

function hcpMinus(id) {
	temp1 = document.getElementById(id.replace("minus", "hcp")).innerText
	if(temp1 !== "no hcp") {
		document.getElementById(id.replace("minus", "hcp")).innerText = parseInt(temp1) - 1;
	        if (id == "minus1btn") {
	           player1hcp = parseInt(temp1) - 1;
	        }
	        if (id == "minus2btn") {
	           player2hcp = parseInt(temp1) - 1;
	        }
	        if (id == "minus3btn") {
	           player3hcp = parseInt(temp1) - 1;
	        }
	        if (id == "minus4btn") {
	           player4hcp = parseInt(temp1) - 1;
	        }
	}
	
}

function hcpPlus(id) {
	temp1 = document.getElementById(id.replace("plus", "hcp")).innerText
	if(temp1 !== "no hcp") {
		document.getElementById(id.replace("plus", "hcp")).innerText = parseInt(temp1) + 1;
		if (id == "plus1btn") {
	           player1hcp = parseInt(temp1) + 1;
	        }
	        if (id == "plus2btn") {
	           player2hcp = parseInt(temp1) + 1;
	        }
	        if (id == "plus3btn") {
	           player3hcp = parseInt(temp1) + 1;
	        }
	        if (id == "plus4btn") {
	           player4hcp = parseInt(temp1) + 1;
	        }
	        
	        
	        console.log(player1hcp)
	}
}

function finishHcpEdit() {
	document.getElementById("hcpeditpopuppanel").style.display = "none";
	//document.getElementById("popuppanel").innerHTML = "";
	after = document.getElementById("hcp1btn").innerText + "<br>";
	after += document.getElementById("hcp2btn").innerText + "<br>";
	after += document.getElementById("hcp3btn").innerText + "<br>";
	after += document.getElementById("hcp4btn").innerText;
	// hcplist changes #11#12#13#14 etc.
	hcplist = after.replaceAll("<br>", "#").replaceAll("#no hcp", "")
	document.getElementById("player4ballhcp").innerHTML = after;
	player1hcp = document.getElementById("hcp1btn").innerText;
	player2hcp = document.getElementById("hcp2btn").innerText;
	player3hcp = document.getElementById("hcp3btn").innerText;
	player4hcp = document.getElementById("hcp4btn").innerText;
}
// choose course dialog for non competition day
function showRecoverChoice() {
	if(compdate == localStorage.xcompdate) {
		tempt = '<br /> Recover saved data or Clear saved data.';
		tempt += '<br /><br />';
		tempt += '<button id="id_recoverbtn" onclick="doSomethingRecover()">Recover</button>';
		tempt += '<button id="id_clearbtn" onclick="doSomethingClear()">Clear</button>';
		document.getElementById("popuppanel").innerHTML = tempt;
		document.getElementById("popuppanel").style.display = "block";
	} else {
		clearLocalStorage()
		document.getElementById("popuppanel").style.display = "none";
	}
}

function doSomethingRecover() {
	//  compdate = localStorage.date4ball
	// etc.
	document.getElementById("popuppanel").style.display = "none";
	// get all the data back and put in right places
	retrieveAllFromLocalStorage()
	// setup number of players and proceed
	getScoring()
}

function doSomethingClear() {
	document.getElementById("popuppanel").style.display = "none";
	clearLocalStorage();
}

function saveAllToLocalStorage() {
	// save player names
	localStorage.setItem("xplayer1name", player1name)
	localStorage.setItem("xplayer2name", player2name)
	localStorage.setItem("xplayer3name", player3name)
	localStorage.setItem("xplayer4name", player4name)
	// save player hcps
	localStorage.setItem("xplayer1hcp", player1hcp)
	localStorage.setItem("xplayer2hcp", player2hcp)
	localStorage.setItem("xplayer3hcp", player3hcp)
	localStorage.setItem("xplayer4hcp", player4hcp)
	// save course
	localStorage.setItem("xcompcourse", compcourse)
	// save date
	localStorage.setItem("xcompdate", compdate)
	// save all scores and points
	var temp1 = "";
	for(i = 1; i <= 18; i++) {
		j = 1;
		temp1 = document.getElementById("p1h" + i).innerText
		if(temp1.indexOf("/") > -1) {
			temp1array = temp1.split("/")
			localStorage.setItem("xp1h" + i, temp1array[0])
		} else {
			localStorage.setItem("xp1h" + i, "0")
		}
		temp1 = document.getElementById("p2h" + i).innerText
		if(temp1.indexOf("/") > -1) {
			temp1array = temp1.split("/")
			localStorage.setItem("xp2h" + i, temp1array[0])
		} else {
			localStorage.setItem("xp2h" + i, "0")
		}
		temp1 = document.getElementById("p3h" + i).innerText
		if(temp1.indexOf("/") > -1) {
			temp1array = temp1.split("/")
			localStorage.setItem("xp3h" + i, temp1array[0])
		} else {
			localStorage.setItem("xp3h" + i, "0")
		}
		temp1 = document.getElementById("p4h" + i).innerText
		if(temp1.indexOf("/") > -1) {
			temp1array = temp1.split("/")
			localStorage.setItem("xp4h" + i, temp1array[0])
		} else {
			localStorage.setItem("xp4h" + i, "0")
		}
	}
	// save totals
	// front 9
	temp1 = document.getElementById("p1hf").innerText
	if(temp1.indexOf("/") > -1) {
		temp1array = temp1.split("/")
		localStorage.setItem("xp1hf", temp1array[0])
	} else {
		localStorage.setItem("xp1hf", "0")
	}
	temp1 = document.getElementById("p2hf").innerText
	if(temp1.indexOf("/") > -1) {
		temp1array = temp1.split("/")
		localStorage.setItem("xp2hf", temp1array[0])
	} else {
		localStorage.setItem("xp2hf", "0")
	}
	temp1 = document.getElementById("p3hf").innerText
	if(temp1.indexOf("/") > -1) {
		temp1array = temp1.split("/")
		localStorage.setItem("xp3hf", temp1array[0])
	} else {
		localStorage.setItem("xp3hf", "0")
	}
	temp1 = document.getElementById("p4hf").innerText
	if(temp1.indexOf("/") > -1) {
		temp1array = temp1.split("/")
		localStorage.setItem("xp4hf", temp1array[0])
	} else {
		localStorage.setItem("xp4hf", "0")
	}
	// back 9
	temp1 = document.getElementById("p1hb").innerText
	if(temp1.indexOf("/") > -1) {
		temp1array = temp1.split("/")
		localStorage.setItem("xp1hb", temp1array[0])
	} else {
		localStorage.setItem("xp1hb", "0")
	}
	temp1 = document.getElementById("p2hb").innerText
	if(temp1.indexOf("/") > -1) {
		temp1array = temp1.split("/")
		localStorage.setItem("xp2hb", temp1array[0])
	} else {
		localStorage.setItem("xp2hb", "0")
	}
	temp1 = document.getElementById("p3hb").innerText
	if(temp1.indexOf("/") > -1) {
		temp1array = temp1.split("/")
		localStorage.setItem("xp3hb", temp1array[0])
	} else {
		localStorage.setItem("xp3hb", "0")
	}
	temp1 = document.getElementById("p4hb").innerText
	if(temp1.indexOf("/") > -1) {
		temp1array = temp1.split("/")
		localStorage.setItem("xp4hb", temp1array[0])
	} else {
		localStorage.setItem("xp4hb", "0")
	}
	// total
	temp1 = document.getElementById("p1ht").innerText
	if(temp1.indexOf("/") > -1) {
		temp1array = temp1.split("/")
		localStorage.setItem("xp1ht", temp1array[0])
	} else {
		localStorage.setItem("xp1ht", "0")
	}
	temp1 = document.getElementById("p2ht").innerText
	if(temp1.indexOf("/") > -1) {
		temp1array = temp1.split("/")
		localStorage.setItem("xp2ht", temp1array[0])
	} else {
		localStorage.setItem("xp2ht", "0")
	}
	temp1 = document.getElementById("p3ht").innerText
	if(temp1.indexOf("/") > -1) {
		temp1array = temp1.split("/")
		localStorage.setItem("xp3ht", temp1array[0])
	} else {
		localStorage.setItem("xp3ht", "0")
	}
	temp1 = document.getElementById("p4ht").innerText
	if(temp1.indexOf("/") > -1) {
		temp1array = temp1.split("/")
		localStorage.setItem("xp4ht", temp1array[0])
	} else {
		localStorage.setItem("xp4ht", "0")
	}
}

function retrieveAllFromLocalStorage() {
	compcourse = course;
	// get date and comp
	compdate = localStorage.getItem("xcompdate");
	compcourse = localStorage.getItem("xcompcourse");
	// get course details
	if(compcourse == "Dawson") {
		arrCourse = arrDeepCopy(arrDawson);
	}
	if(compcourse == "Lakes") {
		arrCourse = arrDeepCopy(arrLakes);
	}
	if(compcourse == "OldCourse") {
		arrCourse = arrDeepCopy(arrOldCourse);
	}
	// recover players names and hcps
	player1name = localStorage.getItem("xplayer1name");
	player2name = localStorage.getItem("xplayer2name");
	player3name = localStorage.getItem("xplayer3name");
	player4name = localStorage.getItem("xplayer4name");
	player1hcp = localStorage.getItem("xplayer1hcp");
	player2hcp = localStorage.getItem("xplayer2hcp");
	player3hcp = localStorage.getItem("xplayer3hcp");
	player4hcp = localStorage.getItem("xplayer4hcp");
	// do shortnames etc.
	body();
	// recover scores, points etc
	for(i = 1; i <= 18; i++) {
		// Recorded scores
		temp1 = localStorage.getItem("xp1h" + i);
		if(temp1 !== "0") {
			temp2 = pointsCalc(arrCourse[1], arrCourse[2], player1hcp, temp1);
			document.getElementById("p1h" + i).innerText = temp1 + "/" + temp2;
		} else {
			document.getElementById("p1h" + i).innerText = "0";
		}
		// Recorded scores
		temp1 = localStorage.getItem("xp2h" + i);
		if(temp1 !== "0") {
			temp2 = pointsCalc(arrCourse[1], arrCourse[2], player2hcp, temp1);
			document.getElementById("p2h" + i).innerText = temp1 + "/" + temp2;
		} else {
			document.getElementById("p2h" + i).innerText = "0";
		}
		// Recorded scores
		temp1 = localStorage.getItem("xp3h" + i);
		if(temp1 !== "0") {
			temp2 = pointsCalc(arrCourse[1], arrCourse[2], player3hcp, temp1);
			document.getElementById("p3h" + i).innerText = temp1 + "/" + temp2;
		} else {
			document.getElementById("p3h" + i).innerText = "0";
		}
		// Recorded scores
		temp1 = localStorage.getItem("xp4h" + i);
		if(temp1 !== "0") {
			temp2 = pointsCalc(arrCourse[1], arrCourse[2], player4hcp, temp1);
			document.getElementById("p4h" + i).innerText = temp1 + "/" + temp2;
		} else {
			document.getElementById("p4h" + i).innerText = "0";
		}
		// do scores for first hole
		document.getElementById("p1score").innerText = localStorage.getItem("xp1h1");
		document.getElementById("p2score").innerText = localStorage.getItem("xp2h1");
		document.getElementById("p3score").innerText = localStorage.getItem("xp3h1");
		document.getElementById("p4score").innerText = localStorage.getItem("xp4h1");
	}
	// redo totals
	totalsCalc()
}

function totalsCalc() {
	p1front = 0
	p2front = 0
	p3front = 0
	p4front = 0
	p1frontpoints = 0
	p2frontpoints = 0
	p3frontpoints = 0
	p4frontpoints = 0
	p1back = 0
	p2back = 0
	p3back = 0
	p4back = 0
	p1backpoints = 0
	p2backpoints = 0
	p3backpoints = 0
	p4backpoints = 0
	for(var i = 1; i <= 9; i++) {
		var tempp1txt = document.getElementById("p1h" + i).innerText
		if(!(tempp1txt == "0")) {
			tempp1 = tempp1txt.split("/");
			p1front += parseInt(tempp1[0])
			p1frontpoints += parseInt(tempp1[1])
		}
		var tempp2txt = document.getElementById("p2h" + i).innerText
		if(!(tempp2txt == "0")) {
			tempp2 = tempp2txt.split("/");
			p2front += parseInt(tempp2[0])
			p2frontpoints += parseInt(tempp2[1])
		}
		var tempp3txt = document.getElementById("p3h" + i).innerText
		if(!(tempp3txt == "0")) {
			tempp3 = tempp3txt.split("/");
			p3front += parseInt(tempp3[0])
			p3frontpoints += parseInt(tempp3[1])
		}
		var tempp4txt = document.getElementById("p4h" + i).innerText
		if(!(tempp4txt == "0")) {
			tempp4 = tempp4txt.split("/");
			p4front += parseInt(tempp4[0])
			p4frontpoints += parseInt(tempp4[1])
		}
	}
	for(var i = 10; i <= 18; i++) {
		var tempp1txt = document.getElementById("p1h" + i).innerText
		if(!(tempp1txt == "0")) {
			tempp1 = tempp1txt.split("/");
			p1back += parseInt(tempp1[0])
			p1backpoints += parseInt(tempp1[1])
		}
		var tempp2txt = document.getElementById("p2h" + i).innerText
		if(!(tempp2txt == "0")) {
			tempp2 = tempp2txt.split("/");
			p2back += parseInt(tempp2[0])
			p2backpoints += parseInt(tempp2[1])
		}
		var tempp3txt = document.getElementById("p3h" + i).innerText
		if(!(tempp3txt == "0")) {
			tempp3 = tempp3txt.split("/");
			p3back += parseInt(tempp3[0])
			p3backpoints += parseInt(tempp3[1])
		}
		var tempp4txt = document.getElementById("p4h" + i).innerText
		if(!(tempp4txt == "0")) {
			tempp4 = tempp4txt.split("/");
			p4back += parseInt(tempp4[0])
			p4backpoints += parseInt(tempp4[1])
		}
	}
	document.getElementById("p1hf").innerText = p1front.toString() + "/" + p1frontpoints.toString();
	document.getElementById("p2hf").innerText = p2front.toString() + "/" + p2frontpoints.toString();
	document.getElementById("p3hf").innerText = p3front.toString() + "/" + p3frontpoints.toString();
	document.getElementById("p4hf").innerText = p4front.toString() + "/" + p4frontpoints.toString();
	document.getElementById("p1hb").innerText = p1back.toString() + "/" + p1backpoints.toString();
	document.getElementById("p2hb").innerText = p2back.toString() + "/" + p2backpoints.toString();
	document.getElementById("p3hb").innerText = p3back.toString() + "/" + p3backpoints.toString();
	document.getElementById("p4hb").innerText = p4back.toString() + "/" + p4backpoints.toString();
	document.getElementById("p1ht").innerText = (p1front + p1back).toString() + "/" + 
	(p1frontpoints + p1backpoints).toString();
	document.getElementById("p2ht").innerText = (p2front + p2back).toString() + "/" + 
	(p2frontpoints + p2backpoints).toString();
	document.getElementById("p3ht").innerText = (p3front + p3back).toString() + "/" + 
	(p3frontpoints + p3backpoints).toString();
	document.getElementById("p4ht").innerText = (p4front + p4back).toString() + "/" + 
	(p4frontpoints + p4backpoints).toString();
}
//clearLocalStorage()
function clearLocalStorage() {
   console.log("clearLocalStorage here")
   Object.keys(localStorage).forEach(function(key){
       if (key.substring(0,1) == "x") {
           //console.log(key)
           localStorage.removeItem(key)
       }
   })
}           
   




      </script>
   </body>
</html>


