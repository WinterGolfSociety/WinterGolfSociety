<!DOCTYPE html>
<html>
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1">
      <meta content="ie=edge" http-equiv="X-UA-Compatible">
      <title>4score</title>
       <link href='https://fonts.googleapis.com/css?family=Kalam' rel='stylesheet'>
      <link href='https://fonts.googleapis.com/css?family=Kalam' rel='stylesheet'>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
      <style>
      
      
      html, body {
  //height: 100dvh;
  //  height: calc(var(--dvh, 1dvh) * 100);
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100% !important;
  
  
  
  
  
}
      
      
      
      
      
         body {
         //font-family: Kalam;
         font-family: Arial, Helvetica, sans-serif;
         font-size: 3dvh;
         overflow: hidden;
		//background-color: darkSlateGray;
		background-image: url("image2.png");
                background-size: cover;
                background-repeat: no-repeat;
         }
         /* front screen */
         .grid-container-frontscreen {
         display: grid;
         grid-template-columns: auto auto auto;
         //width: 94vw;
         color: white; //dodgerBlue; //silver;
         
         
         }
         .grid-container-frontscreen > div {
         font-size: 3dvh;
         text-align: left;
         }
         /* front screen */
         .grid-container-popup {
         display: grid;
         grid-template-columns: auto auto auto auto auto;
         //width: 94vw;
         padding-right: 10px;
         }
         .grid-container-popup > div {
         font-size: 3dvh;
         text-align: center;
         }
         .grid-container-mini {
         display: grid;
         grid-template-columns: 25% 25% 25% 25%;
         }
         .grid-container-mini > div {
         display: flex;
         justify-content: center;
         align-items: center;
         }
         #dropbtn {
         display: flex;
         justify-content: center;
         align-items: center;
         color: white;
         height: 20dvh;
         font-size: 3vmax;
         border: 2px solid silver;
         background: dodgerBlue;
         border-radius: 5px;
         border: 5px solid white;
	 box-shadow: 10px 10px 25px black;
	

         }
         .dropdown {
         position: relative;
         display: inline-block;
         }
         .dropdown-content {
         display: none;
         position: absolute;
         background-color: white;
         min-width: 160px;
         overflow: auto;
         box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
         z-index: 1;
         border-radius: 5px;
         box-shadow: 10px 10px 25px black;
         max-height: 60dvh;
         }
         .dropdown-content a {
         color: gray;
         padding: 10px 16px;
         text-decoration: none;
         display: block;
         }
         .show {
         display: block;
         }
         .wrapperxxx {
         display: grid;
         grid-template-columns: repeat(6, [col] auto);
         background-color: rgb(0, 0, 20);
         color: white;
        height: 100dvh;
         align-items: center;
         justify-items: center;
         scroll-snap-align: start;
         scroll-snap-stop: always;
         font-size: 3vmax;
         }
         #firstscreen {
         -webkit-animation-duration: 1.0s;
         animation-duration: 1.0s;
         -webkit-animation-fill-mode: both;
         animation-fill-mode: both;
         }
         #all {
         display: none;
         
         
         height: 100dvh;
         
         
         
         
         -webkit-animation-duration: 1.0s;
         animation-duration: 1.0s;
         -webkit-animation-fill-mode: both;
         animation-fill-mode: both;
         }
         
         @-webkit-keyframes fadeOut {
         0% {
         opacity: 1;
         }
         100% {
         opacity: 0;
         }
         }
         @keyframes fadeOut {
         0% {
         opacity: 1;
         }
         100% {
         opacity: 0;
         }
         }
         .fadeOut {
         -webkit-animation-name: fadeOut;
         animation-name: fadeOut;
         }
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         @-webkit-keyframes fadeIn {
         0% {
         opacity: 0;
         }
         100% {
         opacity: 1;
         }
         }
         @keyframes fadeIn {
         0% {
         opacity: 0;
         }
         100% {
         opacity: 1;
         }
         }
         .fadeIn {
         -webkit-animation-name: fadeIn;
         animation-name: fadeIn;
         }
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         .spacer1 {
         height: 5dvh;
         }
         #edithcps, #dawsonbutton, #lakesbutton, #oldcoursebutton, #finishbutton {
         color: white;
         width: 100%;
         height: 15dvh;
         font-size: 3vmax;
         border: 2px solid silver;
         background: dodgerBlue;
         border-radius: 5px;
         }
         
         #compbutton {
         display: flex;
         justify-content: center;
         align-items: center;
         color: white;
         //height: 10dvh;
         width: 100%;
         font-size: 3vmax;
         border: 2px solid silver;
         background: dodgerBlue;
         border-radius: 5px;
         }
         
         #startscoring {
         display: none;
         color: white;
         //width: 100%;
         height: 15dvh;
         font-size: 3vmax;
         
            background: dodgerBlue;
         //opacity: 0.8;
           border-radius: 5px;
           border: 5px solid white;
         box-shadow: 10px 10px 25px black;
         padding: 5px;
         text-align: center;
         
         
         
         
         
         
         
         
         }
         #hcp1btn, #hcp2btn, #hcp3btn, #hcp4btn {
         font-size: 3dvh;
         color: black;
         background-color: silver;
         border-radius: 5px;
         border: 1px solid #aaa;
         }
         #minus1btn, #minus2btn, #minus3btn, #minus4btn {
         font-size: 8dvh;
         color: dodgerBlue;
         background-color: silver;
         border-radius: 5px;
         border: 1px solid #aaa;
         }
         #plus1btn, #plus2btn, #plus3btn, #plus4btn {
         font-size: 8dvh;
         color: dodgerBlue;
         background-color: silver;
         border-radius: 5px;
         border: 1px solid #aaa;
         }
         .pnom {
         color: black;
         background-color: silver;
         border-radius: 5px;
         border: 1px solid #aaa;
         }
         .grid-container-top {
         display: grid;
         grid-template-columns: auto;
         }
         .grid-container-top > div
         {
         font-size: 4.5dvh;
         display: flex;
         justify-content: center;
         align-items: center;
         text-align: center;
         border-radius: 5px;
         height: 10dvh;
         color: white;
         background: dodgerBlue;
         border: 5px solid white;
     //    box-shadow: inset blue 0px 0px 60px -12px;	
         }
         .grid-container-middle
         {
         display: grid;
         grid-template-columns: auto calc(98vw/3);
         }
         .grid-container-middle > div
         {
         
          background: dodgerBlue;
         color: white;
        opacity: 0.9;
         //font-weight: bold;
         
         display: flex;
         justify-content: center;
         align-items: center;
         text-align: center;
         font-size: 2.7dvh; //2.5dvh;
          //border-radius: 2px;
          border: 1px solid white;
         //box-shadow: inset white 0px 0px 60px -12px;
         height: 10dvh;
         }
         .grid-container-bottom
         {
         display: grid;
         grid-template-columns: calc(98vw/3) auto calc(98vw/3);
         
         
         
         border-radius: 5px;
         // border: 5px solid white;
         box-shadow: inset white 0px 0px 60px -12px;
         opacity: 0.9;
         
         
         
         
         }
         .grid-container-bottom > div
         {
         font-size: 5dvh;
         display: flex;
         justify-content: center;
         align-items: center;
         text-align: center;
         border-radius: 5px;
         height: 10dvh;	
         }
         #p1score,
         #p2score,
         #p3score,
         #p4score
         {
         font-size: 5dvh;
        
         }
         .highlight
         {
         color: white; //black;
         border: 1px solid black;
         box-shadow: inset black 0px 0px 60px -12px;
         }
         .scorelow
         {
         color: white;
         background: dodgerBlue;
         border: 1px solid white;
  //       box-shadow: inset blue 0px 0px 60px -12px;
         }
         .scorehigh
         {
         color: white; //black;
         background: white;
         border: 1px solid black;
         box-shadow: inset black 0px 0px 60px -12px;
         }
         #info
         {
         display: none;
         overflow: auto;
         position: absolute;
         top: 1dvh;
         left: 2vw;
         height: 125dvh;
         width: 97vw;
         color: white;
         background-color: dimGray;
         opacity: 0.99;
         border-radius:10px;
         padding-left: 2px;
         padding-right: 2px;
         padding-bottom: 10px;
     //    box-shadow: inset black 0px 0px 60px -12px;
         }
         #p1h0, #p2h0, #p3h0, #p4h0 {
         padding-top: 5px;
         font-size: 2dvh;
         padding-bottom: 5px;
         }
         #x1 {
        // color: yellow;
        // font-size: 2dvh;
         
        
         
         
         }
         
         
         #id_recoverbtn,
    #id_clearbtn {
      background-color: #ccc;
      font-size: 4dvh;
      display: inline-block;
      border-radius: 3px;
      border: 1px solid #aaa;
      padding: 10px;
      margin: 3px;
      text-align: center;
      //width: 75px;
      height: 50px;
      cursor: pointer;
    }
      
    #popuppanel {
    background-color: #ddd;
      font-size: 3dvh;
      display: inline-block;
      border-radius: 3px;
      border: 1px solid #aaa;
      padding: 10px;
      margin: 5vw;
      text-align: center;
      width: 80vw;
      //height: 50px;
      cursor: pointer;
    }     
    
    #submit {
    position: fixed;
    bottom: 1dvh;
    left: 5vw;
    color: white;
    background: dodgerBlue;
     font-size: 5dvh;
      display: inline-block;
      border-radius: 10px;
      border: 2px solid darkSlateGray;
      padding: 30px;
      margin: 10vw;
      text-align: center;
      cursor: pointer;
      box-shadow: 10px 10px 25px black;
    }
    
    #submittxt {
         display: none;
       //  font-size: 2dvh;
         position: absolute;
         top: 30%;
         left: 1%;
       //  max-height: 60%;
        // width: 93%;
        // color: white;
         background-color: transparent;
        // border-radius:10px;
        // padding: 1dvh;
        // border: 2px solid darkSlateGray;
       //  box-shadow: 10px 10px 25px black;
         }
    
    #submittxt1 {
    
    
         display: none;
         font-size: 3dvh;
         position: absolute;
         top: 0;
         left: 1vw;
         color: white;
         background-color: dodgerBlue; //ForestGreen; //SeaGreen;
         border-radius:10px;
         padding: 4dvh 2dvh;
         border: 2px solid darkSlateGray;
         box-shadow: 10px 10px 25px black;
         }
        
    #senddata1 {
         background-color: dodgerBlue;
         border-radius: 10px;
         padding: 2dvh 2dvh;
         border: 2px solid darkSlateGray;
         box-shadow: 10px 10px 25px black;
         }
    
    #my-response-iframe, #my-form {
    display: none;
    }  
        
        #shaded {
        background: dodgerBlue;
         //opacity: 0.8;
           border-radius: 5px;
           border: 5px solid white;
         box-shadow: 10px 10px 25px black;
         padding: 5px;
        }
         
         
         
         .small {
         background: darkSlateGray;
          border-radius: 2px;
          border: 2px solid black;
         box-shadow: inset black 0px 0px 60px -12px;
         opacity: 0.9;
         } 
         
        .spacer1 {
        height: 1dvh;
        } 
         
      </style>
   </head>
   <body>
      <div id="firstscreen">
         <div class="xxxwrapper">
            <div onclick="toggleDropdown();" class="dropbtn" id="dropbtn">tap to add player 1</div>
            <div id="playersDropdown" class="dropdown-content"></div>
            <div class="spacer1"></div>
            <div id="popuppanel"></div>
            
            <div class="grid-container-frontscreen" id="shaded">
               <div id="player4ballplayer">no players have been added</div>
               <div id="player4ballname"></div>
               <div id="player4ballhcp"></div>
            </div>
            <div class="grid-container-frontscreen">
               <div class="spacer1"></div>
               <div class="spacer1"></div>
               <div class="spacer1"></div>
            </div>
            <!--
            <div class="grid-container-frontscreen">
               <div></div>
            -->   
               <div  id="startscoring" onclick="getScoring()">start scoring</div>
            -->
            <!--   
               <div></div>
            </div>
            -->
            <div class="grid-container-frontscreen">
               <div class="spacer1"></div>
               <div class="spacer1"></div>
               <div class="spacer1"></div>
            </div>
            <!--
            <div class="grid-container-frontscreen">
               <div></div>
               <div id="compbutton">no competition</div>
               <div></div>
            </div>
            -->
         </div>
      </div>
      <div id="all">
      <div id="toblur">
      <div class="grid-container-top">
         <div id="holedetails" onclick="displayInfo()"></div>
      </div>
      
      <div class="spacer1"></div>
      
      <div class="grid-container-middle">
         <div id="p1name" onclick="selected(this.id)">player 1</div>
         <div id="p1score" onclick="selected(this.id)">0</div>
         <div id="p2name" onclick="selected(this.id)">player 2</div>
         <div id="p2score" onclick="selected(this.id)">0</div>
         <div id="p3name" onclick="selected(this.id)">player 3</div>
         <div id="p3score" onclick="selected(this.id)">0</div>
         <div id="p4name" onclick="selected(this.id)">player 4</div>
         <div id="p4score" onclick="selected(this.id)">0</div>
      </div>
      
      <div class="spacer1"></div>
      
      <div class="grid-container-bottom">
         <div class="small scorelow" id="score1" onclick="numberScore(this.id)">1</div>
         <div class="small scorelow" id="score2" onclick="numberScore(this.id)">2</div>
         <div class="small scorelow" id="score3" onclick="numberScore(this.id)">3</div>
         <div class="small scorelow" id="score4" onclick="numberScore(this.id)">4</div>
         <div class="small scorelow" id="score5" onclick="numberScore(this.id)">5</div>
         <div class="small scorelow" id="score6" onclick="numberScore(this.id)">6</div>
         <div class="small scorelow" id="score7" onclick="numberScore(this.id)">7</div>
         <div class="small scorelow" id="score8" onclick="numberScore(this.id)">8</div>
         <div class="small scorelow" id="score9" onclick="numberScore(this.id)">9</div>
         <div class="small scorelow" id="scoreprev" onclick="predvhole()">prev</div>
         <div class="small scorelow" id="score0" onclick="numberScore(this.id)">0</div>
         <div class="small scorelow" id="scorenext" onclick="nextHole()">next</div>
      </div>
      </div> <!-- toblur -->
      <div id="submittxt1"></div>
      <div id="submittxt"></div>
      
      <div id="info" onclick="hideInfo()">
         <div id="x1"></div>
         <div class="grid-container-popup">
            <div id="h0"></div>
            <div id="p1h0">player 1</div>
            <div id="p2h0">player 2</div>
            <div id="p3h0">player 3</div>
            <div id="p4h0">player 4</div>
            <div id="h1">1</div>
            <div id="p1h1">-</div>
            <div id="p2h1">-</div>
            <div id="p3h1">-</div>
            <div id="p4h1">-</div>
            <div id="h2">2</div>
            <div id="p1h2">-</div>
            <div id="p2h2">-</div>
            <div id="p3h2">-</div>
            <div id="p4h2">-</div>
            <div id="h3">3</div>
            <div id="p1h3">-</div>
            <div id="p2h3">-</div>
            <div id="p3h3">-</div>
            <div id="p4h3">-</div>
            <div id="h4">4</div>
            <div id="p1h4">-</div>
            <div id="p2h4">-</div>
            <div id="p3h4">-</div>
            <div id="p4h4">-</div>
            <div id="h5">5</div>
            <div id="p1h5">-</div>
            <div id="p2h5">-</div>
            <div id="p3h5">-</div>
            <div id="p4h5">-</div>
            <div id="h6">6</div>
            <div id="p1h6">-</div>
            <div id="p2h6">-</div>
            <div id="p3h6">-</div>
            <div id="p4h6">-</div>
            <div id="h7">7</div>
            <div id="p1h7">-</div>
            <div id="p2h7">-</div>
            <div id="p3h7">-</div>
            <div id="p4h7">-</div>
            <div id="h8">8</div>
            <div id="p1h8">-</div>
            <div id="p2h8">-</div>
            <div id="p3h8">-</div>
            <div id="p4h8">-</div>
            <div id="h9">9</div>
            <div id="p1h9">-</div>
            <div id="p2h9">-</div>
            <div id="p3h9">-</div>
            <div id="p4h9">-</div>
            <div id="front">front</div>
            <div id="p1hf">-</div>
            <div id="p2hf">-</div>
            <div id="p3hf">-</div>
            <div id="p4hf">-</div>
            <div id="h10">10</div>
            <div id="p1h10">-</div>
            <div id="p2h10">-</div>
            <div id="p3h10">-</div>
            <div id="p4h10">-</div>
            <div id="h11">11</div>
            <div id="p1h11">-</div>
            <div id="p2h11">-</div>
            <div id="p3h11">-</div>
            <div id="p4h11">-</div>
            <div id="h12">12</div>
            <div id="p1h12">-</div>
            <div id="p2h12">-</div>
            <div id="p3h12">-</div>
            <div id="p4h12">-</div>
            <div id="h13">13</div>
            <div id="p1h13">-</div>
            <div id="p2h13">-</div>
            <div id="p3h13">-</div>
            <div id="p4h13">-</div>
            <div id="h14">14</div>
            <div id="p1h14">-</div>
            <div id="p2h14">-</div>
            <div id="p3h14">-</div>
            <div id="p4h14">-</div>
            <div id="h15">15</div>
            <div id="p1h15">-</div>
            <div id="p2h15">-</div>
            <div id="p3h15">-</div>
            <div id="p4h15">-</div>
            <div id="h16">16</div>
            <div id="p1h16">-</div>
            <div id="p2h16">-</div>
            <div id="p3h16">-</div>
            <div id="p4h16">-</div>
            <div id="h17">17</div>
            <div id="p1h17">-</div>
            <div id="p2h17">-</div>
            <div id="p3h17">-</div>
            <div id="p4h17">-</div>
            <div id="h18">18</div>
            <div id="p1h18">-</div>
            <div id="p2h18">-</div>
            <div id="p3h18">-</div>
            <div id="p4h18">-</div>
            <div id="back">back</div>
            <div id="p1hb">-</div>
            <div id="p2hb">-</div>
            <div id="p3hb">-</div>
            <div id="p4hb">-</div>
            <div id="total">total</div>
            <div id="p1ht">-</div>
            <div id="p2ht">-</div>
            <div id="p3ht">-</div>
            <div id="p4ht">-</div>
         </div>
         
        
      <div><button id="submit" onclick="submit4()">Submit</button></div>
       
         
      </div>
      
      
      
      
      
      	
	
	<!--
	invisible nut necessary for submit of data
	-->
	
	 <!-- form to construct data prior to submit -->
  <form action="https://docs.google.com/forms/d/e/1FAIpQLSdqW6j0CDZA8gOpRn3Wew6KNKkeEf1T6w2-f0qKgwacddblkA/formResponse" id="my-form" method="post" name="my-form" target="my-response-iframe">
    <!-- name, hcp, course -->
    <input id='mx867055232' name='entry.867055232' type='text' value='default'>
    <input id='mx2105479454' name='entry.2105479454' type='text' value='default'>
   
    <input type="submit"> </form>
  <!-- google iframe inserted here - invisible -->
  <iframe height="20" id="my-response-iframe" name="my-response-iframe" src="https://docs.google.com/forms/d/e/1FAIpQLSdqW6j0CDZA8gOpRn3Wew6KNKkeEf1T6w2-f0qKgwacddblkA/viewform?embedded=true" width="60"></iframe>
  <br>
  
	
	
	
	
	
	
	
	
	
	
      
      
      
      
      
      
      
      
      
      
      
      <script>  
//=================================================================================
// this runs on startup or reload
// 
//=================================================================================







const resizeOps = () => {
    document.documentElement.style.setProperty("--dvh", window.innerHeight * 0.01 + "px");
  };

  resizeOps();
  window.addEventListener("resize", resizeOps);
















// declare global variables
var selectedplayer = 1;
// hilight first player entry
document.getElementById("p1name").classList.add("highlight");
var arrCourse = [];
var arrHCPs = [];
var arrPlayers = [];
var compcourse = "none";
var compdate = "";
var shotsscore = "";
var currenthole = 0;
// declare global variables
var hcp = "0";
var player = "select player";
var comp;
var course = "OldCourse";
var arrOptions = [];
var hcplist = "";
var msglist = "";
var msglistcount = 0;
var player1name = "player 1";
var player2name = "player 2";
var player3name = "player 3";
var player4name = "player 4";
var player1hcp = "no hcp";
var player2hcp = "no hcp";
var player3hcp = "no hcp";
var player4hcp = "no hcp";
var originalhcp1 = 0;
var originalhcp2 = 0;
var originalhcp3 = 0;
var originalhcp4 = 0;
var whichhole = 1;

var frontp1 = 0
var frontp2 = 0
var frontp3 = 0
var backp1 = 0
var backp2 = 0
var backp3 = 0
var allp1 = 0
var allp2 = 0
var allp3 = 0
var fronttxt9 = "";
var backtxt9 = "";
var alltxt18 = "";
var frontleaderplayer = "";
var frontleaderholes = 0;
var frontwincount = 0;
var backleaderplayer = "";
var backleaderholes = 0;
var backwincount = 0;
var allleaderplayer = "";
var allleaderholes = 0;
var allwincount = 0;

var submitpressed



// set up courses with details for calculations etc.
// array ["hole num",par,si]
// Lakes
arrLakes = [
	[0, 0, 0],
	[1, 4, 15],
	[2, 4, 7],
	[3, 5, 3],
	[4, 4, 1],
	[5, 3, 17],
	[6, 3, 11],
	[7, 4, 9],
	[8, 4, 5],
	[9, 4, 13],
	[10, 3, 16],
	[11, 4, 18],
	[12, 4, 10],
	[13, 4, 6],
	[14, 3, 14],
	[15, 3, 4],
	[16, 5, 12],
	[17, 4, 2],
	[18, 5, 8]
];
// array ["hole num",par,si]
// Dawson
arrDawson = [
	[0, 0, 0],
	[1, 5, 13],
	[2, 4, 15],
	[3, 3, 17],
	[4, 4, 3],
	[5, 4, 1],
	[6, 5, 11],
	[7, 4, 7],
	[8, 4, 9],
	[9, 5, 5],
	[10, 4, 16],
	[11, 5, 14],
	[12, 3, 18],
	[13, 4, 2],
	[14, 4, 4],
	[15, 4, 12],
	[16, 3, 6],
	[17, 4, 10],
	[18, 4, 8]
];
// array ["hole num",par,si]
// OldCourse
arrOldCourse = [
	[0, 0, 0],
	[1, 5, 10],
	[2, 4, 6],
	[3, 3, 18],
	[4, 5, 4],
	[5, 3, 16],
	[6, 4, 2],
	[7, 4, 14],
	[8, 4, 8],
	[9, 4, 12],
	[10, 4, 5],
	[11, 3, 13],
	[12, 4, 15],
	[13, 4, 1],
	[14, 5, 7],
	[15, 3, 11],
	[16, 5, 9],
	[17, 4, 3],
	[18, 5, 17]
];

// prevent accidental closing
window.addEventListener("beforeunload", stopexit) 

function stopexit(e) {
   // Cancel the event
   e.preventDefault();
   e.returnValue = "";
};

/*
// 1st hole
var holedetails = "hole " + arrOldCourse[whichhole][0] + ", par " + arrOldCourse[whichhole][1] + 
", si " + arrOldCourse[whichhole][2]
document.getElementById("holedetails").innerText = holedetails
*/

	//===========================
	// this code runs at startup
	//===========================
	//==============================================================
	// data has previously been stored so just retrieve it
	//==============================================================
	// retrieve arrays
if("wplayersarray" in localStorage) {
	arrPlayers = JSON.parse(localStorage.wplayersarray);
}
if("whcparray" in localStorage) {
	arrHCPs = JSON.parse(localStorage.whcparray);
}

//showDownloadingInfoMsg();
chooseCourse()
startNewDay();
//=============================================================
// functions - run when called
//=============================================================  
function startNewDay() {
	// get todays date eg 26 June
	dd = new Date();
	// get date number and format it
	d1 = dd.getDate();
	if(d1 < 10) {
		d1 = "0" + d1;
	}
	// get month and format it
	d2 = dd.getMonth();
	if(d2 == 0) {
		m = "January";
	}
	if(d2 == 1) {
		m = "February";
	}
	if(d2 == 2) {
		m = "March";
	}
	if(d2 == 3) {
		m = "April";
	}
	if(d2 == 4) {
		m = "May";
	}
	if(d2 == 5) {
		m = "June";
	}
	if(d2 == 6) {
		m = "July";
	}
	if(d2 == 7) {
		m = "August";
	}
	if(d2 == 8) {
		m = "September";
	}
	if(d2 == 9) {
		m = "October";
	}
	if(d2 == 10) {
		m = "November";
	}
	if(d2 == 11) {
		m = "December";
	}
	dateToday = d1 + " " + m;
	dstored = d1 + "-" + d2
	compdate = d1 + " " + m;



        if (localStorage.wthisComp.indexOf(dateToday) > -1) {
           document.getElementById("startscoring").innerHTML = "start scoring<br>" + localStorage.wthisComp
        } 
        
        //else {
        //   document.getElementById("compbutton").innerHTML = "no competition"
        //}




//	if(localStorage.wcompdate !== compdate) {
		// create set of local storage items	
		setupScores()
//	}
	// doublecheck ??    
	if("wcomp" in localStorage) {
		// if its a new comp
		if(localStorage.xcomp.indexOf(dateToday) < 0) {
			localStorage.removeItem("wcomp");
			localStorage.removeItem("wcourse");
			localStorage.removeItem("wplayer");
			localStorage.removeItem("whcp");
			localStorage.setItem("wdstored", dstored);
		}
	}
}



document.getElementById("popuppanel").style.display = "none";
	start();
	showRecoverChoice()



	//=============================================================
	//=============================================================
	// function start()
	// - initialise everything and do checks etc.
	//=============================================================  
function start() {
	// bring most commonly selected to the top
	//arrPlayers.sort(compareSecondColumn);
	// create player dropdown
	var select = document.getElementById("playersDropdown");
	// this is what is created
	//<a id="myLink1" href="#" onclick='dropSelected(this.innerText);return false;'>Graham Airey</a>
	//
	for(var i = 0; i < arrPlayers.length; i++) {
		var el = document.createElement("a");
		el.id = "myLink" + (i);
		el.setAttribute("onclick", "dropSelected(this.innerText);return false;");
		el.setAttribute("href", "#");
		el.innerText = arrPlayers[i];
		select.appendChild(el);
	}
	// Close the dropdown if the user clicks outside of it
	window.onclick = function(event) {
		if(!event.target.matches('.dropbtn')) {
			var dropdowns = document.getElementsByClassName("dropdown-content");
			var i;
			for(i = 0; i < dropdowns.length; i++) {
				var openDropdown = dropdowns[i];
				if(openDropdown.classList.contains('show')) {
					openDropdown.classList.remove('show');
				}
			}
		}
	};
	// get todays date eg 26 June
	dd = new Date();
	// get date number and format it
	d1 = dd.getDate();
	if(d1 < 10) {
		d1 = "0" + d1;
	}
	// get month and format it
	d2 = dd.getMonth();
	if(d2 == 0) {
		m = "January";
	}
	if(d2 == 1) {
		m = "February";
	}
	if(d2 == 2) {
		m = "March";
	}
	if(d2 == 3) {
		m = "April";
	}
	if(d2 == 4) {
		m = "May";
	}
	if(d2 == 5) {
		m = "June";
	}
	if(d2 == 6) {
		m = "July";
	}
	if(d2 == 7) {
		m = "August";
	}
	if(d2 == 8) {
		m = "September";
	}
	if(d2 == 9) {
		m = "October";
	}
	if(d2 == 10) {
		m = "November";
	}
	if(d2 == 11) {
		m = "December";
	}
	compdate = d1 + " " + m;
} // end function start()
//=============================================================
// functions - run when called
//=============================================================  
//=============================================================
// function resetNames()
// - gets rid of "selected" names
//=============================================================  
function resetNames() {
	// create player dropdown
	var select = document.getElementById("playersDropdown");
	// empty names
	select.innerHTML = "";
	// redo list for menu
	// <a id="myLink1" href="#" onclick='dropSelected(this.innerText);return false;'>Graham Airey</a>
	//
	for(var i = 0; i < arrPlayers.length; i++) {
		var el = document.createElement("a");
		el.id = "myLink" + (i + 1);
		el.setAttribute("onclick", "dropSelected(this.innerText);return false;");
		el.setAttribute("href", "#");
		el.innerText = arrPlayers[i];
		select.appendChild(el);
	}
}
// name selected, do stuff
function dropSelected(playerName) {
	// retrieve dropdown info
	for(var k = 0; k < arrPlayers.length; k++) {
		if(arrPlayers[k] == playerName) {
			found = true;
			pos = k;
		}
	}
	// change color on selection
	document.getElementById("myLink" + pos.toString()).style.color = "blue";
	document.getElementById("myLink" + pos.toString()).style.background = "lightBlue";
	// update player choice
	player = document.getElementById("myLink" + pos.toString()).innerText;
	outputPlayers(player)
		// close dropdown
	var dropdowns = document.getElementsByClassName("dropdown-content");
	var i;
	for(i = 0; i < dropdowns.length; i++) {
		var openDropdown = dropdowns[i];
		if(openDropdown.classList.contains('show')) {
			openDropdown.classList.remove('show');
		}
	}
}
//=============================================================
// function toggleDropdown()
// - show player name choices
//=============================================================  
function toggleDropdown() {
	// When the user clicks on the button, toggle between hiding and showing the dropdown content
	document.getElementById("playersDropdown").classList.toggle("show");
}
//=============================================================
// function showDownloadingInfoMsg()
// - show message when downloading player and course info and creating arrays
//=============================================================  
function showDownloadingInfoMsg() {
	document.getElementById("popuppanel").innerHTML = 
	'<br>Retrieving Course and Player information.<br><br><img src="throbber.gif" width=50 height=48>';
	document.getElementById("popuppanel").style.display = "block";
}

function shortName(nom) {
	// shorten player name
	s1 = nom.split(" ")
	shortPlayername = s1[0] + " " + s1[1].substring(0, 1);
	shortPlayername = shortPlayername.replace("Stephen", "Steve")
	shortPlayername = shortPlayername.replace("Malcolm", "Mal")
	return shortPlayername;
}

function firstName(nom) {
s1 = nom.split(" ")
firstPlayername = s1[0];
firstPlayername = firstPlayername.replace("Stephen", "Steve")
firstPlayername = firstPlayername.replace("Malcolm", "Mal")
return firstPlayername;
}

function body() {

// for 4 ball
document.getElementById("p1name").innerText = shortName(player1name) + " (" + player1hcp + ") ";
document.getElementById("p2name").innerText = shortName(player2name) + " (" + player2hcp + ") ";
document.getElementById("p3name").innerText = shortName(player3name) + " (" + player3hcp + ") ";
document.getElementById("p4name").innerText = shortName(player4name) + " (" + player4hcp + ") ";


}
//=================================================================================
// highlight the current player number
// 
//=================================================================================	
function selected(id) {
	// reset all player names
	document.getElementById("p1name").classList.remove("highlight");
	document.getElementById("p2name").classList.remove("highlight");
	document.getElementById("p3name").classList.remove("highlight");
	document.getElementById("p4name").classList.remove("highlight");
	// highlight selected
	selectedplayer = id.replace("score", "").replace("name", "").replace("p", "")
	document.getElementById("p" + selectedplayer + "name").classList.add("highlight");
}
//=================================================================================
// put score in the selected player
// and move on	
//=================================================================================
function numberScore(id) {
	// id is something like score2
	// selectedplayer is global 1, 2, 3, 4
	if(("1234").indexOf(selectedplayer) > -1) {
		// id is number button pressed eg. score5
		temppscore = "p" + selectedplayer + "score"
		temppname = "p" + selectedplayer + "name"
			// highlight number button for a brief time
		tempid = document.getElementById(id)
		temppscoreid = document.getElementById(temppscore)
		temppnameid = document.getElementById(temppname)
			// do number button
		tempid.classList.replace("scorelow", "scorehigh");
		// do score entered
		temppscoreid.classList.add("highlight");
		// do player name
		temppnameid.classList.add("highlight");
		// delay putting everything back
		setTimeout(() => {
			// put number button back
			tempid.classList.replace("scorehigh", "scorelow");
			// put score back
			temppscoreid.classList.remove("highlight");
			// put player name back
			temppnameid.classList.remove("highlight");
			// update score
			document.getElementById(temppscore).innerText = id.replace("score", "")
				// move on to next player and highlight
			selectedplayer++
			if(selectedplayer <= 4) {
				tempstrokesid = document.getElementById("p" + selectedplayer + "name")
				tempstrokesid.classList.add("highlight");
			} else {
				selectedplayer = 0
			}
		}, "100");
	}
}
//=================================================================================
// move to next hole
// 
//=================================================================================
function nextHole() {
	saveScores()
	document.getElementById("scorenext").classList.replace("scorelow", "scorehigh");
	// delay putting everything back
	setTimeout(() => {
		// put number button back
		document.getElementById("scorenext").classList.replace("scorehigh", "scorelow");
	}, "250");
	whichhole++
	if (whichhole > 18) {
	    whichhole = 18;
	}
	// highlight if shot hole
	//highlightShots();
	holedetails = "hole " + arrCourse[whichhole][0] + ", par " + arrCourse[whichhole][1] + 
	", si " + arrCourse[whichhole][2]
		// get hole details
	document.getElementById("holedetails").innerText = holedetails
		// get hole scores
	document.getElementById("p1h" + whichhole).innerText = localStorage.getItem("wp1h" + whichhole);
	document.getElementById("p2h" + whichhole).innerText = localStorage.getItem("wp2h" + whichhole);
	document.getElementById("p3h" + whichhole).innerText = localStorage.getItem("wp3h" + whichhole);
	document.getElementById("p4h" + whichhole).innerText = localStorage.getItem("wp4h" + whichhole);
	// reset all player name backgrounds
	document.getElementById("p1name").classList.remove("highlight");
	document.getElementById("p2name").classList.remove("highlight");
	document.getElementById("p3name").classList.remove("highlight");
	document.getElementById("p4name").classList.remove("highlight");
	document.getElementById("p1score").innerText = "0"
	document.getElementById("p2score").innerText = "0"
	document.getElementById("p3score").innerText = "0"
	document.getElementById("p4score").innerText = "0"
	selectedplayer = 1
	document.getElementById("p1name").classList.add("highlight");
	// get scores  
	getScores()
}
//=================================================================================
// move to the previous hole
//
//=================================================================================
function predvhole() {
	saveScores()
	document.getElementById("scoreprev").classList.replace("scorelow", "scorehigh");
	// delay putting everything back
	setTimeout(() => {
		// put number button back
		document.getElementById("scoreprev").classList.replace("scorehigh", "scorelow");
	}, "250");
	whichhole--
	if (whichhole < 1) {
	    whichhole = 1
	}
	// highlight if shot hole
	//highlightShots()
	// get hole details
	holedetails = "hole " + arrCourse[whichhole][0] + ", par " + arrCourse[whichhole][1] + 
	", si " + arrCourse[whichhole][2]
	document.getElementById("holedetails").innerText = holedetails
		// get hole scores
	document.getElementById("p1h" + whichhole).innerText = localStorage.getItem("wp1h" + whichhole);
	document.getElementById("p2h" + whichhole).innerText = localStorage.getItem("wp2h" + whichhole);
	document.getElementById("p3h" + whichhole).innerText = localStorage.getItem("wp3h" + whichhole);
	document.getElementById("p4h" + whichhole).innerText = localStorage.getItem("wp4h" + whichhole);
	// change highlight colour
	document.getElementById("p1name").classList.remove("highlight");
	document.getElementById("p2name").classList.remove("highlight");
	document.getElementById("p3name").classList.remove("highlight");
	document.getElementById("p4name").classList.remove("highlight");
	selectedplayer = 1
	document.getElementById("p1name").classList.add("highlight");
	// retrieve scores   
	getScores()
}
//=================================================================================
// create an empty set of local storage score containers
// and move on	
//=================================================================================
function setupScores() {
	// do date check here
	//console.log((localStorage.xcompdate !== compdate))
	if(localStorage.wcompdate !== compdate) {
		for(var i = 1; i <= 18; i++) {
			for(var j = 1; j <= 4; j++) {
				localStorage.setItem("wp" + j + "h" + i, "0")
			}
		}
		localStorage.wcompdate = compdate;
	}
}
//=================================================================================
// save scores for a single page to local storage
// 
//=================================================================================
function saveScores() {
	// if all 0 tidy up, else, only save if scores are there
	if (document.getElementById("p1score").innerText == "0" && 
	    document.getElementById("p2score").innerText == "0" && 
	    document.getElementById("p3score").innerText == "0" && 
	    document.getElementById("p4score").innerText == "0") {
	    // dont save and reset info page value and localStorage
	    document.getElementById("p1h" + whichhole).innerText = "0/0";
	    document.getElementById("p2h" + whichhole).innerText = "0/0";
	    document.getElementById("p3h" + whichhole).innerText = "0/0";
	    document.getElementById("p4h" + whichhole).innerText = "0/0";
	    localStorage.setItem("wp1h" + whichhole, "0")
	    localStorage.setItem("wp2h" + whichhole, "0")
	    localStorage.setItem("wp3h" + whichhole, "0")
	    localStorage.setItem("wp4h" + whichhole, "0")
	} else {      	     
		localStorage.setItem("wp1h" + whichhole, document.getElementById("p1score").innerText)
		localStorage.setItem("wp2h" + whichhole, document.getElementById("p2score").innerText)
		localStorage.setItem("wp3h" + whichhole, document.getElementById("p3score").innerText)
		localStorage.setItem("wp4h" + whichhole, document.getElementById("p4score").innerText)
	}
}
//=================================================================================
// get scores for a single page from local storage
// 
//=================================================================================
function getScores() {
	document.getElementById("p1score").innerText = localStorage.getItem("wp1h" + whichhole)
	document.getElementById("p2score").innerText = localStorage.getItem("wp2h" + whichhole)
	document.getElementById("p3score").innerText = localStorage.getItem("wp3h" + whichhole)
	document.getElementById("p4score").innerText = localStorage.getItem("wp4h" + whichhole)
}

function outputPlayers(msg) {
	// msg is player name eg "Bryan Maddison"
	// find HCP
	var hcp;
	for(var i = 0, len = arrPlayers.length; i < len; i++) {
		if(arrPlayers[i] === msg) {
			hcp = arrHCPs[i];
			break;
		}
	}
	msglistcount++
	if(msglistcount > 4) {
		console.log("too many players")
	} else {
		if(hcplist == "") {
			hcplist = hcp;
		} else {
			hcplist += "#" + hcp
		}
	}
	hcplistx = hcplist + "#no hcp#no hcp#no hcp#ho hcp#no hcp"
	arr2 = hcplistx.split("#");
	player1hcp = arr2[0];
	player2hcp = arr2[1];
	player3hcp = arr2[2];
	player4hcp = arr2[3];
	
	if(msglistcount > 4) {
		console.log("too many players")
	} else {
		if(msglist == "") {
			msglist = msg;
			// enable scoring button if player there and course chosen
//			if(compcourse !== "none") {
				document.getElementById("startscoring").style.display = "block";
//			}
		} else {
			msglist += "#" + msg
		}
	}
	msglistx = msglist + "#no player#no player#no player#no player#no player"
	arr1 = msglistx.split("#");
	newmsglistplayer = "Player 1:" + "<br>" + "Player 2:" + "<br>" + "Player 3:" + "<br>" + "Player 4:"
	newmsglistname = arr1[0] + "<br>" + arr1[1] + "<br>" + arr1[2] + "<br>" + arr1[3]
	newmsglisthcp = player1hcp + "<br>" + player2hcp + "<br>" + player3hcp + "<br>" + player4hcp
	newmsglist = "Player 1: " + arr1[0] + "<br>" + "Player 2: " + arr1[1] + "<br>" + "Player 3: " + 
	arr1[2] + "<br>" + "Player 4: " + arr1[3]
	document.getElementById("player4ballplayer").innerHTML = newmsglistplayer
	document.getElementById("player4ballname").innerHTML = newmsglistname
	document.getElementById("player4ballhcp").innerHTML = newmsglisthcp
		// add players names
	player1name = arr1[0]
	player2name = arr1[1]
	player3name = arr1[2]
	player4name = arr1[3]
	if(arr1[3] == "no player") {
		txt = "tap to add player 4"
	}
	if(arr1[2] == "no player") {
		txt = "tap to add player 3"
	}
	if(arr1[1] == "no player") {
		txt = "tap to add player 2"
	}
	if(arr1[0] == "no player") {
		txt = "tap to add player 1"
	}
	document.getElementById("dropbtn").innerText = txt;
	// just close it now
	if(arr1[3] !== "no player") {
		// hide button
		document.getElementById("dropbtn").style.display = "none";
	}
	body();
}

function chooseCourse() {
	
		// choose course
	if(localStorage.wthisComp.indexOf("Dawson") > -1) {
		arrCourse = arrDeepCopy(arrDawson);
	}
	if(localStorage.wthisComp.indexOf("Lakes") > -1) {
		arrCourse = arrDeepCopy(arrLakes);
	}
	if(localStorage.wthisComp.indexOf("OldCourse") > -1) {
		arrCourse = arrDeepCopy(arrOldCourse);
	}
	if(document.getElementById("player4ballplayer").innerText.indexOf("no players have been added") < 0) {
		document.getElementById("startscoring").style.display = "block";
	}
	// update button to show course
	//	document.getElementById("coll0").innerText = "Scores for " + compcourse;
	
	
	
	
	
	// 1st hole needs initialising because no next/prev has been used
var holedetails = "hole " + arrCourse[whichhole][0] + ", par " + arrCourse[whichhole][1] + 
", si " + arrCourse[whichhole][2]
document.getElementById("holedetails").innerText = holedetails
	
	
	
	
	
	
}
// helper function to deep copy array
function arrDeepCopy(aObject) {
	// deep copy array
	// Prevent undefined objects
	// if (!aObject) return aObject;
	var bObject = Array.isArray(aObject) ? [] : {};
	var value;
	for(const key in aObject) {
		// Prevent self-references to parent object
		// if (Object.is(aObject[key], aObject)) continue;
		value = aObject[key];
		bObject[key] = (typeof value === "object") ? arrDeepCopy(value) : value;
	}
	return bObject;
}

function getScoring() {
        // save new hcps
        // submit new data - asychronous after first so does not cause a delay
        delay1 = 2000
        delay2 = 4000
        delay3 = 6000
        
	for(var i = 0, len = arrPlayers.length; i < len; i++) {
		if(arrPlayers[i] === player1name) {
			originalhcp1 = arrHCPs[i];
			if(originalhcp1 !== player1hcp) {
				document.getElementById('mx867055232').value = player1name;
				document.getElementById('mx2105479454').value = player1hcp;
//				document.forms[0].submit();
			}
		}
		// delay others
		if(arrPlayers[i] === player2name) {
			originalhcp2 = arrHCPs[i];
			if(originalhcp2 !== player2hcp) {
				setTimeout(function() {
					document.getElementById('mx867055232').value = player2name;
					document.getElementById('mx2105479454').value = player2hcp;
//					document.forms[0].submit();
				}, delay1);
			}
		}
		if(arrPlayers[i] === player3name) {
			originalhcp3 = arrHCPs[i];
			if(originalhcp3 !== player3hcp) {
				setTimeout(function() {
					document.getElementById('mx867055232').value = player3name;
					document.getElementById('mx2105479454').value = player3hcp;
//					document.forms[0].submit();
				}, delay2);
			}
		}
		if(arrPlayers[i] === player4name) {
			originalhcp4 = arrHCPs[i];
			if(originalhcp4 !== player4hcp) {
				setTimeout(function() {
					document.getElementById('mx867055232').value = player4name;
					document.getElementById('mx2105479454').value = player4hcp;
//					document.forms[0].submit();
				}, delay3);
			}
		}
	}





        // update hcps in case they have been edited        
        body();
        // highlight if shot hole
	//highlightShots();
        // set up for correct number of players
        if (player4name == "no player") {
            player4hcp = 99;
            document.getElementById("p4name").style.display = "none";
            document.getElementById("p4score").style.display = "none"   
        }
        if (player3name == "no player") {
            player3hcp = 99;
            document.getElementById("p3name").style.display = "none";
            document.getElementById("p3score").style.display = "none"   
        }
        if (player2name == "no player") {
            player2hcp = 99;
            document.getElementById("p2name").style.display = "none";
            document.getElementById("p2score").style.display = "none"   
        }
        if (player1name == "no player") {
            player1hcp = 99;
            document.getElementById("p1name").style.display = "none";
            document.getElementById("p1score").style.display = "none"   
        }
        
        
        
	document.getElementById("firstscreen").classList.add("fadeOut");
	setTimeout(() => {
		document.getElementById("firstscreen").style.display = "none";
		//document.getElementById("all").style.display = "initial"
		document.getElementById("all").classList.add("fadeIn");
	}, "700");
	
	
	
	
	
	setTimeout(() => {
		document.getElementById("all").style.display = "initial";
		//document.getElementById("all").style.display = "initial"
	}, "1400");
	
	
	
	
	//document.getElementById("all").style.display = "initial"
		// set up for correct number of players
		// initial save of data
	saveAllToLocalStorage()
}

function displayInfo() {
	saveScores();
	//saveAllToLocalStorage()
	// get players, all strokes and points
	document.getElementById("p1h0").innerText = shortName(player1name);
	document.getElementById("p2h0").innerText = shortName(player2name);
	document.getElementById("p3h0").innerText = shortName(player3name);
	document.getElementById("p4h0").innerText = shortName(player4name);
	for(var i = 1; i <= 18; i++) {
		temp = localStorage.getItem("wp1h" + i)
		document.getElementById("p1h" + i).innerText = temp + "/" + 
		pointsCalc(player1hcp, arrCourse[i][1], arrCourse[i][2], temp)
		temp = localStorage.getItem("wp2h" + i)
		document.getElementById("p2h" + i).innerText = temp + "/" + 
		pointsCalc(player2hcp, arrCourse[i][1], arrCourse[i][2], temp)
		temp = localStorage.getItem("wp3h" + i)
		document.getElementById("p3h" + i).innerText = temp + "/" + 
		pointsCalc(player3hcp, arrCourse[i][1], arrCourse[i][2], temp)
		temp = localStorage.getItem("wp4h" + i)
		document.getElementById("p4h" + i).innerText = temp + "/" + 
		pointsCalc(player4hcp, arrCourse[i][1], arrCourse[i][2], temp)
	}
	totalScore()
	//shots()
		// show screen as overlay
	if(document.getElementById("info").style.display !== "block") {
		document.getElementById("info").style.display = "block"
	} else {
		document.getElementById("info").style.display = "none"
	}
}

function hideInfo() {
document.getElementById("info").style.display = "none"

}

// calculated additional totals, countback etc.
function totalScore() {
	// front 9 scores
	var p1ih = 0;
	var p2ih = 0;
	var p3ih = 0;
	var p4ih = 0;
	// front 9 points
	var p1ip = 0;
	var p2ip = 0;
	var p3ip = 0;
	var p4ip = 0;
	// back 9 scores
	var p1jh = 0;
	var p2jh = 0;
	var p3jh = 0;
	var p4jh = 0;
	// back 9 points
	var p1jp = 0;
	var p2jp = 0;
	var p3jp = 0;
	var p4jp = 0;
	// totals
	var p1f = 0;
	var p1b = 0;
	var p1t = 0;
	var p2f = 0;
	var p2b = 0;
	var p2t = 0;
	var p3f = 0;
	var p3b = 0;
	var p3t = 0;
	var p4f = 0;
	var p4b = 0;
	var p4t = 0;
	// do scores and points
	for(i = 1; i <= 9; i++) {
		//const [name, street, unit, city, state, zip] = input.split("/");
		var [tempp1ih, tempp1ip] = document.getElementById("p1h" + i).innerText.split("/");
		var [tempp2ih, tempp2ip] = document.getElementById("p2h" + i).innerText.split("/");
		var [tempp3ih, tempp3ip] = document.getElementById("p3h" + i).innerText.split("/");
		var [tempp4ih, tempp4ip] = document.getElementById("p4h" + i).innerText.split("/");
		p1ih += parseInt(tempp1ih)
		p2ih += parseInt(tempp2ih)
		p3ih += parseInt(tempp3ih)
		p4ih += parseInt(tempp4ih)
		p1ip += parseInt(tempp1ip)
		p2ip += parseInt(tempp2ip)
		p3ip += parseInt(tempp3ip)
		p4ip += parseInt(tempp4ip)
	}
	for(j = 10; j <= 18; j++) {
		//const [name, street, unit, city, state, zip] = input.split("/");
		var [tempp1jh, tempp1jp] = document.getElementById("p1h" + j).innerText.split("/");
		var [tempp2jh, tempp2jp] = document.getElementById("p2h" + j).innerText.split("/");
		var [tempp3jh, tempp3jp] = document.getElementById("p3h" + j).innerText.split("/");
		var [tempp4jh, tempp4jp] = document.getElementById("p4h" + j).innerText.split("/");
		p1jh += parseInt(tempp1jh)
		p2jh += parseInt(tempp2jh)
		p3jh += parseInt(tempp3jh)
		p4jh += parseInt(tempp4jh)
		p1jp += parseInt(tempp1jp)
		p2jp += parseInt(tempp2jp)
		p3jp += parseInt(tempp3jp)
		p4jp += parseInt(tempp4jp)
	}
	p1f = p1ih + p1jh;
	p2f = p2ih + p2jh;
	p3f = p3ih + p3jh;
	p4f = p4ih + p4jh;
	p1fp = p1ip + p1jp;
	p2fp = p2ip + p2jp;
	p3fp = p3ip + p3jp;
	p4fp = p4ip + p4jp;
	document.getElementById("p1hf").innerText = p1ih + "/" + p1ip;
	document.getElementById("p2hf").innerText = p2ih + "/" + p2ip;
	document.getElementById("p3hf").innerText = p3ih + "/" + p3ip;
	document.getElementById("p4hf").innerText = p4ih + "/" + p4ip;
	document.getElementById("p1hb").innerText = p1jh + "/" + p1jp;
	document.getElementById("p2hb").innerText = p2jh + "/" + p2jp;
	document.getElementById("p3hb").innerText = p3jh + "/" + p3jp;
	document.getElementById("p4hb").innerText = p4jh + "/" + p4jp;
	document.getElementById("p1ht").innerText = p1f + "/" + p1fp;
	document.getElementById("p2ht").innerText = p2f + "/" + p2fp;
	document.getElementById("p3ht").innerText = p3f + "/" + p3fp;
	document.getElementById("p4ht").innerText = p4f + "/" + p4fp;
}
// convert scores to stableford points
function pointsCalc(xhcp, xpar, xsi, xscore) {
hcp = parseInt(xhcp)
par = parseInt(xpar)
si = parseInt(xsi)
score = parseInt(xscore)
	allowance = 0;
	if(score == 0) {
		return 0;
	} else {
	        // cope with minus hcp
	        if(hcp < 0) {
	          // 18 plus a minus hcp
	          if((18 + parseInt(hcp)) < si) {
			allowance = -1;
		  }	
		}
	
		// allowance   
		if(hcp >= si) {
			allowance = 1;
		}
		if(hcp >= (18 + si)) {
			allowance = 2;
		}
		if(hcp >= (36 + si)) {
			allowance = 3;
		}		
		// points
		var points = (par + allowance + 2) - score;
		// remove negative numbers
		if(points < 0) {
			points = 0;
		}
		return points;
	}
}

// choose course dialog for non competition day
function showRecoverChoice() {
// if there are some scores in ...
var testx = "123456789"
        if (testx.indexOf(localStorage.getItem("wp1h1")) > -1 ||
            testx.indexOf(localStorage.getItem("wp2h1")) > -1 ||
            testx.indexOf(localStorage.getItem("wp3h1")) > -1 ||
            testx.indexOf(localStorage.getItem("wp4h1")) > -1 ) {

//	if(compdate == localStorage.xcompdate) {

		tempt = '<br /> Recover or Clear saved data.';
		tempt += '<br /><br />';
		tempt += '<button id="id_recoverbtn" onclick="doSomethingRecover()">Recover</button>';
		tempt += '<button id="id_clearbtn" onclick="doSomethingClear()">Clear</button>';
		document.getElementById("popuppanel").innerHTML = tempt;
		document.getElementById("popuppanel").style.display = "block";
	} else {
//		clearLocalStorage()
		document.getElementById("popuppanel").style.display = "none";
	}
}

function doSomethingRecover() {
	//  compdate = localStorage.date4ball
	// etc.
	document.getElementById("popuppanel").style.display = "none";
	// get all the data back and put in right places
	retrieveAllFromLocalStorage()
	// setup number of players and proceed
	getScoring();
	moveToCurrent();
}

function doSomethingClear() {
	document.getElementById("popuppanel").style.display = "none";
	clearLocalStorage();
}

function saveAllToLocalStorage() {
	// save player names
	localStorage.setItem("wplayer1name", player1name)
	localStorage.setItem("wplayer2name", player2name)
	localStorage.setItem("wplayer3name", player3name)
	localStorage.setItem("wplayer4name", player4name)
	// save player hcps
	localStorage.setItem("wplayer1hcp", player1hcp)
	localStorage.setItem("wplayer2hcp", player2hcp)
	localStorage.setItem("wplayer3hcp", player3hcp)
	localStorage.setItem("wplayer4hcp", player4hcp)
	// save course
	localStorage.setItem("xcompcourse", compcourse)
	// save date
	localStorage.setItem("xcompdate", compdate)
	// save all scores and points
	var temp1 = "";
	for(i = 1; i <= 18; i++) {
		j = 1;
		temp1 = document.getElementById("p1h" + i).innerText
		if(temp1.indexOf("/") > -1) {
			temp1array = temp1.split("/")
			localStorage.setItem("wp1h" + i, temp1array[0])
		} else {
			localStorage.setItem("wp1h" + i, "0")
		}
		temp1 = document.getElementById("p2h" + i).innerText
		if(temp1.indexOf("/") > -1) {
			temp1array = temp1.split("/")
			localStorage.setItem("wp2h" + i, temp1array[0])
		} else {
			localStorage.setItem("wp2h" + i, "0")
		}
		temp1 = document.getElementById("p3h" + i).innerText
		if(temp1.indexOf("/") > -1) {
			temp1array = temp1.split("/")
			localStorage.setItem("wp3h" + i, temp1array[0])
		} else {
			localStorage.setItem("wp3h" + i, "0")
		}
		temp1 = document.getElementById("p4h" + i).innerText
		if(temp1.indexOf("/") > -1) {
			temp1array = temp1.split("/")
			localStorage.setItem("wp4h" + i, temp1array[0])
		} else {
			localStorage.setItem("wp4h" + i, "0")
		}
	}
	// save totals
	// front 9
	temp1 = document.getElementById("p1hf").innerText
	if(temp1.indexOf("/") > -1) {
		temp1array = temp1.split("/")
		localStorage.setItem("wp1hf", temp1array[0])
	} else {
		localStorage.setItem("wp1hf", "0")
	}
	temp1 = document.getElementById("p2hf").innerText
	if(temp1.indexOf("/") > -1) {
		temp1array = temp1.split("/")
		localStorage.setItem("wp2hf", temp1array[0])
	} else {
		localStorage.setItem("wp2hf", "0")
	}
	temp1 = document.getElementById("p3hf").innerText
	if(temp1.indexOf("/") > -1) {
		temp1array = temp1.split("/")
		localStorage.setItem("wp3hf", temp1array[0])
	} else {
		localStorage.setItem("wp3hf", "0")
	}
	temp1 = document.getElementById("p4hf").innerText
	if(temp1.indexOf("/") > -1) {
		temp1array = temp1.split("/")
		localStorage.setItem("wp4hf", temp1array[0])
	} else {
		localStorage.setItem("wp4hf", "0")
	}
	// back 9
	temp1 = document.getElementById("p1hb").innerText
	if(temp1.indexOf("/") > -1) {
		temp1array = temp1.split("/")
		localStorage.setItem("wp1hb", temp1array[0])
	} else {
		localStorage.setItem("wp1hb", "0")
	}
	temp1 = document.getElementById("p2hb").innerText
	if(temp1.indexOf("/") > -1) {
		temp1array = temp1.split("/")
		localStorage.setItem("wp2hb", temp1array[0])
	} else {
		localStorage.setItem("wp2hb", "0")
	}
	temp1 = document.getElementById("p3hb").innerText
	if(temp1.indexOf("/") > -1) {
		temp1array = temp1.split("/")
		localStorage.setItem("wp3hb", temp1array[0])
	} else {
		localStorage.setItem("wp3hb", "0")
	}
	temp1 = document.getElementById("p4hb").innerText
	if(temp1.indexOf("/") > -1) {
		temp1array = temp1.split("/")
		localStorage.setItem("wp4hb", temp1array[0])
	} else {
		localStorage.setItem("wp4hb", "0")
	}
	// total
	temp1 = document.getElementById("p1ht").innerText
	if(temp1.indexOf("/") > -1) {
		temp1array = temp1.split("/")
		localStorage.setItem("wp1ht", temp1array[0])
	} else {
		localStorage.setItem("wp1ht", "0")
	}
	temp1 = document.getElementById("p2ht").innerText
	if(temp1.indexOf("/") > -1) {
		temp1array = temp1.split("/")
		localStorage.setItem("wp2ht", temp1array[0])
	} else {
		localStorage.setItem("wp2ht", "0")
	}
	temp1 = document.getElementById("p3ht").innerText
	if(temp1.indexOf("/") > -1) {
		temp1array = temp1.split("/")
		localStorage.setItem("wp3ht", temp1array[0])
	} else {
		localStorage.setItem("wp3ht", "0")
	}
	temp1 = document.getElementById("p4ht").innerText
	if(temp1.indexOf("/") > -1) {
		temp1array = temp1.split("/")
		localStorage.setItem("wp4ht", temp1array[0])
	} else {
		localStorage.setItem("wp4ht", "0")
	}
}

function retrieveAllFromLocalStorage() {
	compcourse = course;
	// get date and comp
	compdate = localStorage.getItem("xcompdate");
	compcourse = localStorage.getItem("xcompcourse");
	// get course details
	if(compcourse == "Dawson") {
		arrCourse = arrDeepCopy(arrDawson);
	}
	if(compcourse == "Lakes") {
		arrCourse = arrDeepCopy(arrLakes);
	}
	if(compcourse == "OldCourse") {
		arrCourse = arrDeepCopy(arrOldCourse);
	}
	// recover players names and hcps
	player1name = localStorage.getItem("wplayer1name");
	player2name = localStorage.getItem("wplayer2name");
	player3name = localStorage.getItem("wplayer3name");
	player4name = localStorage.getItem("wplayer4name");
	player1hcp = localStorage.getItem("wplayer1hcp");
	player2hcp = localStorage.getItem("wplayer2hcp");
	player3hcp = localStorage.getItem("wplayer3hcp");
	player4hcp = localStorage.getItem("wplayer4hcp");
	// do shortnames etc.
	body();
	// recover scores, points etc
	for(i = 1; i <= 18; i++) {
		// Recorded scores
		temp1 = localStorage.getItem("wp1h" + i);
		if(temp1 !== "0") {
			temp2 = pointsCalc(arrCourse[1], arrCourse[2], player1hcp, temp1);
			document.getElementById("p1h" + i).innerText = temp1 + "/" + temp2;
		} else {
			document.getElementById("p1h" + i).innerText = "0";
		}
		// Recorded scores
		temp1 = localStorage.getItem("wp2h" + i);
		if(temp1 !== "0") {
			temp2 = pointsCalc(arrCourse[1], arrCourse[2], player2hcp, temp1);
			document.getElementById("p2h" + i).innerText = temp1 + "/" + temp2;
		} else {
			document.getElementById("p2h" + i).innerText = "0";
		}
		// Recorded scores
		temp1 = localStorage.getItem("wp3h" + i);
		if(temp1 !== "0") {
			temp2 = pointsCalc(arrCourse[1], arrCourse[2], player3hcp, temp1);
			document.getElementById("p3h" + i).innerText = temp1 + "/" + temp2;
		} else {
			document.getElementById("p3h" + i).innerText = "0";
		}
		// Recorded scores
		temp1 = localStorage.getItem("wp4h" + i);
		if(temp1 !== "0") {
			temp2 = pointsCalc(arrCourse[1], arrCourse[2], player4hcp, temp1);
			document.getElementById("p4h" + i).innerText = temp1 + "/" + temp2;
		} else {
			document.getElementById("p4h" + i).innerText = "0";
		}
		// do scores for first hole
		document.getElementById("p1score").innerText = localStorage.getItem("wp1h1");
		document.getElementById("p2score").innerText = localStorage.getItem("wp2h1");
		document.getElementById("p3score").innerText = localStorage.getItem("wp3h1");
		document.getElementById("p4score").innerText = localStorage.getItem("wp4h1");
	}
	// redo totals
	totalsCalc()
}

function totalsCalc() {
	p1front = 0
	p2front = 0
	p3front = 0
	p4front = 0
	p1frontpoints = 0
	p2frontpoints = 0
	p3frontpoints = 0
	p4frontpoints = 0
	p1back = 0
	p2back = 0
	p3back = 0
	p4back = 0
	p1backpoints = 0
	p2backpoints = 0
	p3backpoints = 0
	p4backpoints = 0
	for(var i = 1; i <= 9; i++) {
		var tempp1txt = document.getElementById("p1h" + i).innerText
		if(!(tempp1txt == "0")) {
			tempp1 = tempp1txt.split("/");
			p1front += parseInt(tempp1[0])
			p1frontpoints += parseInt(tempp1[1])
		}
		var tempp2txt = document.getElementById("p2h" + i).innerText
		if(!(tempp2txt == "0")) {
			tempp2 = tempp2txt.split("/");
			p2front += parseInt(tempp2[0])
			p2frontpoints += parseInt(tempp2[1])
		}
		var tempp3txt = document.getElementById("p3h" + i).innerText
		if(!(tempp3txt == "0")) {
			tempp3 = tempp3txt.split("/");
			p3front += parseInt(tempp3[0])
			p3frontpoints += parseInt(tempp3[1])
		}
		var tempp4txt = document.getElementById("p4h" + i).innerText
		if(!(tempp4txt == "0")) {
			tempp4 = tempp4txt.split("/");
			p4front += parseInt(tempp4[0])
			p4frontpoints += parseInt(tempp4[1])
		}
	}
	for(var i = 10; i <= 18; i++) {
		var tempp1txt = document.getElementById("p1h" + i).innerText
		if(!(tempp1txt == "0")) {
			tempp1 = tempp1txt.split("/");
			p1back += parseInt(tempp1[0])
			p1backpoints += parseInt(tempp1[1])
		}
		var tempp2txt = document.getElementById("p2h" + i).innerText
		if(!(tempp2txt == "0")) {
			tempp2 = tempp2txt.split("/");
			p2back += parseInt(tempp2[0])
			p2backpoints += parseInt(tempp2[1])
		}
		var tempp3txt = document.getElementById("p3h" + i).innerText
		if(!(tempp3txt == "0")) {
			tempp3 = tempp3txt.split("/");
			p3back += parseInt(tempp3[0])
			p3backpoints += parseInt(tempp3[1])
		}
		var tempp4txt = document.getElementById("p4h" + i).innerText
		if(!(tempp4txt == "0")) {
			tempp4 = tempp4txt.split("/");
			p4back += parseInt(tempp4[0])
			p4backpoints += parseInt(tempp4[1])
		}
	}
	document.getElementById("p1hf").innerText = p1front.toString() + "/" + p1frontpoints.toString();
	document.getElementById("p2hf").innerText = p2front.toString() + "/" + p2frontpoints.toString();
	document.getElementById("p3hf").innerText = p3front.toString() + "/" + p3frontpoints.toString();
	document.getElementById("p4hf").innerText = p4front.toString() + "/" + p4frontpoints.toString();
	document.getElementById("p1hb").innerText = p1back.toString() + "/" + p1backpoints.toString();
	document.getElementById("p2hb").innerText = p2back.toString() + "/" + p2backpoints.toString();
	document.getElementById("p3hb").innerText = p3back.toString() + "/" + p3backpoints.toString();
	document.getElementById("p4hb").innerText = p4back.toString() + "/" + p4backpoints.toString();
	document.getElementById("p1ht").innerText = (p1front + p1back).toString() + "/" + 
	(p1frontpoints + p1backpoints).toString();
	document.getElementById("p2ht").innerText = (p2front + p2back).toString() + "/" + 
	(p2frontpoints + p2backpoints).toString();
	document.getElementById("p3ht").innerText = (p3front + p3back).toString() + "/" + 
	(p3frontpoints + p3backpoints).toString();
	document.getElementById("p4ht").innerText = (p4front + p4back).toString() + "/" + 
	(p4frontpoints + p4backpoints).toString();
}
//clearLocalStorage()
function clearLocalStorage() {
   //console.log("clearLocalStorage here")
   Object.keys(localStorage).forEach(function(key){
       if (key.substring(0,1) == "w") {
           //console.log(key)
           localStorage.removeItem(key)
       }
   })
}           
   

function moveToCurrent() {

var lastOne = 0;
var i = 0;
// go backwards
for (i = 18; i > 0; i--) {
    var tempp1txt = document.getElementById("p1h" + i).innerText    
    var tempp2txt = document.getElementById("p2h" + i).innerText    
    var tempp3txt = document.getElementById("p3h" + i).innerText    
    var tempp4txt = document.getElementById("p4h" + i).innerText  

    // find current entry    
    if (tempp1txt == 0 &&
        tempp2txt == 0 &&
        tempp3txt == 0 &&
        tempp4txt == 0 ) {
           // cope with movement to previous score
           // lastOne = (i - 1);
           lastOne = i;
    }
}

//move to last one
whichhole = lastOne;
// get hole details
	// highlight if shot hole
	//highlightShots()
	// get hole details
	holedetails = "hole " + arrCourse[whichhole][0] + ", par " + arrCourse[whichhole][1] + 
	", si " + arrCourse[whichhole][2]
	document.getElementById("holedetails").innerText = holedetails
		// get hole scores
	document.getElementById("p1h" + whichhole).innerText = localStorage.getItem("wp1h" + whichhole);
	document.getElementById("p2h" + whichhole).innerText = localStorage.getItem("wp2h" + whichhole);
	document.getElementById("p3h" + whichhole).innerText = localStorage.getItem("wp3h" + whichhole);
	document.getElementById("p4h" + whichhole).innerText = localStorage.getItem("wp4h" + whichhole);
	// change highlight colour
	document.getElementById("p1name").classList.remove("highlight");
	document.getElementById("p2name").classList.remove("highlight");
	document.getElementById("p3name").classList.remove("highlight");
	document.getElementById("p4name").classList.remove("highlight");
	selectedplayer = 1
	document.getElementById("p1name").classList.add("highlight");
	// retrieve scores   
	getScores()
}

function submit4() {
document.getElementById("submittxt").innerHTML = "<img src='senddata1.gif' id='senddata1' style='height:70%;width:90%'>"
document.getElementById("submittxt1").innerHTML = player1name + " .. uploading"
// blur background
//document.getElementById("toblur").style.filter = "blur(4px) contrast(5%)"; 
document.getElementById("toblur").style.filter = "blur(1px) contrast(1%)"; 
setTimeout(function() {
document.getElementById("submittxt1").style.display = "block"
document.getElementById("submittxt").style.display = "block"
}, 100);
// submit new data - asychronous after first so does not cause a delay

// player 1
if (player1name !== "no player") {
//				document.getElementById('mx867055232').value = player1name;
//				document.getElementById('mx2105479454').value = player1hcp;
//				document.forms[0].submit();
delay2 = 2000
delay5 = 4000
delay6 = 5500
}
// delay others
// player 2
if (player2name !== "no player") {
delay3 = 4000
delay5 = 6000
delay6 = 7500
setTimeout(function() {
   //					document.getElementById('mx867055232').value = player2name;
   //					document.getElementById('mx2105479454').value = player2hcp;
   //					document.forms[0].submit();
   document.getElementById("submittxt1").innerHTML = player2name + " .. uploading"
}, delay2);
}

// player 3
if (player3name !== "no player") {
delay4 = 6000
delay5 = 8000
delay6 = 95000
setTimeout(function() {
   //					document.getElementById('mx867055232').value = player3name;
   //					document.getElementById('mx2105479454').value = player3hcp;
   //					document.forms[0].submit();
   document.getElementById("submittxt1").innerHTML = player3name + " .. uploading"
}, delay3);
}

// player 4
if (player4name !== "no player") {
delay5 = 10000
delay6 = 11500
setTimeout(function() {
   //					document.getElementById('mx867055232').value = player4name;
   //					document.getElementById('mx2105479454').value = player4hcp;
   //					document.forms[0].submit();
   document.getElementById("submittxt1").innerHTML = player4name + " .. uploading"
}, delay4);
}		
// completed	
setTimeout(function() {
   document.getElementById("submittxt1").innerHTML = "completed"
   // change to green tick
   document.getElementById("submittxt").style.top = "50%"
   document.getElementById("submittxt").style.left = "20%"  
   
   
   
   
   
   document.getElementById("submittxt").innerHTML = "<div><img src='tick1.png' id='senddata1' style='height:50vw;width:50vw'></div>"
   
   document.getElementById("senddata1").style.borderRadius = "50%";
   
}, delay5);
 
// return to main menu
setTimeout(function() {
// reverse the prevent accidental closing
window.removeEventListener("beforeunload", stopexit)
history.back()
//   window.location.assign("winter2023v2.html");
}, delay6);
 
 
 
 
 
                    
// close
setTimeout(function() {
   // reset to orignal CSS so a resubmit goes through same process
   document.getElementById("submittxt1").style.display = "none"
   document.getElementById("submittxt").style.display = "none"

   document.getElementById("submittxt").style.top = "30%" 
   document.getElementById("submittxt").style.left = "5%" 


document.getElementById("senddata1").style.borderRadius = "10px";


   // unblur background and return to menu
   document.getElementById("toblur").style.filter = "blur(0px)"; 
}, delay6);

}

      </script>
   </body>
</html>


